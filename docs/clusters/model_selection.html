
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Clustering model selection matrix &#8212; Urban Grammar AI | WP2 - Spatial Signatures</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/sphinx-book-theme.5f77b4aec8189eecf79907ce328c390d.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Generate Spatial Signatures across GB" href="spatial_signatures_gb.html" />
    <link rel="prev" title="Trial of clustering on OpenMap and MasterMap data" href="mastermap_openmap_cluster.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/logo.svg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Urban Grammar AI | WP2 - Spatial Signatures</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <p class="caption">
 <span class="caption-text">
  Project
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference external" href="http://urbangrammarai.github.io">
   Project homepage
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="http://urbangrammarai.github.io/data_processing">
   WP1 - Data processing
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Spatial unit
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../spatial_unit/unit.html">
   Exploration of tessellation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../spatial_unit/enclosed_tessellation.html">
   Enclosed tessellation (proof of a concept)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../spatial_unit/Parallelized_enclosures.html">
   Generating enclosures (proof of a concept)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../spatial_unit/Generate_enclosures.html">
   Generate enclosures for the Great Britain
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../spatial_unit/chunk_uk.html">
   Geo-chunking Great Britain
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../spatial_unit/chunked_enclosed_tessellation.html">
   Generate enclosed tessellation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../spatial_unit/hierarchical_ids.html">
   Generate hierarchical unique IDs
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Populating units with data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../measuring/cross-chunk_indices.html">
   Cross-chunk indices
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../measuring/morphometrics.html">
   Urban morphometrics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../measuring/functional_data.html">
   Functional data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../measuring/accessibility.html">
   Accessibility-based characters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../measuring/GHS-composite-S2_ndvi.html">
   NDVI
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Cluster analysis
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="mastermap_openmap_cluster.html">
   Trial of clustering on OpenMap and MasterMap data
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Clustering model selection matrix
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="spatial_signatures_gb.html">
   Generate Spatial Signatures across GB
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="exploration_of_signatures.html">
   Exploration of top-level clusters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="form_signatures_GB.html">
   Form-based signatures across GB
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/clusters/model_selection.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/urbangrammarai/spatial_signatures"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/urbangrammarai/spatial_signatures/master?urlpath=tree/clusters/model_selection.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dimensions">
   Dimensions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#algorithms">
     Algorithms
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-normalisation">
     Data normalisation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dimensionality-reduction">
     Dimensionality reduction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#number-of-clusters">
     Number of clusters
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#input-data">
     Input data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#comparison">
   Comparison
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#quantitative-data">
     Quantitative data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#qualitative-data">
     Qualitative data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#first-phase">
   First phase
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   Data normalisation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#harmonize-chunks">
     Harmonize chunks
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#test-cases">
   Test cases
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#evaluation">
   Evaluation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#test-matrix">
   Test matrix
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#full-scale">
   Full scale
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="clustering-model-selection-matrix">
<h1>Clustering model selection matrix<a class="headerlink" href="#clustering-model-selection-matrix" title="Permalink to this headline">¶</a></h1>
<p>This notebook compares performance of various clustering models aimed at the selection of the optimal model for delineation of spatial signatures.</p>
<div class="section" id="dimensions">
<h2>Dimensions<a class="headerlink" href="#dimensions" title="Permalink to this headline">¶</a></h2>
<p>Dimensions of models to be tested.</p>
<div class="section" id="algorithms">
<h3>Algorithms<a class="headerlink" href="#algorithms" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>K-Means</p></li>
<li><p>K-Medoid</p></li>
<li><p>SOM</p>
<ul>
<li><p>different architectures</p>
<ul>
<li><p>grid dimensions</p></li>
<li><p>parameter selection</p></li>
</ul>
</li>
</ul>
</li>
<li><p>GMM</p></li>
</ul>
</div>
<div class="section" id="data-normalisation">
<h3>Data normalisation<a class="headerlink" href="#data-normalisation" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>MinMax stretch</p></li>
<li><p>Standardise</p></li>
<li><p>RobustScaler?</p></li>
</ul>
</div>
<div class="section" id="dimensionality-reduction">
<h3>Dimensionality reduction<a class="headerlink" href="#dimensionality-reduction" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>PCA</p></li>
<li><p>tSNA?</p></li>
<li><p>K-means with k&gt;200?</p></li>
</ul>
</div>
<div class="section" id="number-of-clusters">
<h3>Number of clusters<a class="headerlink" href="#number-of-clusters" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>n -&gt; m</p></li>
</ul>
</div>
<div class="section" id="input-data">
<h3>Input data<a class="headerlink" href="#input-data" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Form</p></li>
<li><p>Function</p></li>
<li><p>Form &amp; Function</p></li>
</ul>
</div>
</div>
<div class="section" id="comparison">
<h2>Comparison<a class="headerlink" href="#comparison" title="Permalink to this headline">¶</a></h2>
<div class="section" id="quantitative-data">
<h3>Quantitative data<a class="headerlink" href="#quantitative-data" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Mean sampled silhouette score</p></li>
<li><p>Calinski-Harabasz</p></li>
<li><p>Davies-Bouldin</p></li>
<li><p>BIC</p></li>
</ul>
</div>
<div class="section" id="qualitative-data">
<h3>Qualitative data<a class="headerlink" href="#qualitative-data" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>label frequencies</p></li>
<li><p>cross tabulation</p>
<ul>
<li><p>postcode classification</p></li>
<li><p>modum</p></li>
<li><p>worldpop</p></li>
</ul>
</li>
<li><p>N-S, E-W distribution of cluster centers</p>
<ul>
<li><p>weighted by area?</p></li>
</ul>
</li>
<li><p>Signatures</p>
<ul>
<li><p>polygon areas</p></li>
<li><p>distances between signatures of the same kind</p></li>
<li><p>number of polygons/components (how many times we see the signature type)</p></li>
</ul>
</li>
<li><p>maps for a few cities</p>
<ul>
<li><p>Liverpool</p></li>
<li><p>Glasgow</p></li>
<li><p>London</p></li>
</ul>
</li>
<li><p>clustergram for every algorithm</p></li>
</ul>
</div>
</div>
<div class="section" id="first-phase">
<h2>First phase<a class="headerlink" href="#first-phase" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Each algorithm on a few similar</p></li>
</ul>
</div>
<div class="section" id="id1">
<h2>Data normalisation<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Since we’ll be reusing normalised/standardised data repeatedly, we do the transformation once and store results in chunked parquet files.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dask.dataframe</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">form</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/morphometrics/convolutions/conv_*.pq&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">standardized</span> <span class="o">=</span> <span class="p">(</span><span class="n">form</span> <span class="o">-</span> <span class="n">form</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">form</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">standardized</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/form/standardized/&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 3min 43s, sys: 1min 14s, total: 4min 57s
Wall time: 3min 47s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">min_max</span> <span class="o">=</span> <span class="p">(</span><span class="n">form</span> <span class="o">-</span> <span class="n">form</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">form</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">min_max</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/form/normalized/&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 3min 1s, sys: 1min 7s, total: 4min 8s
Wall time: 3min 48s
</pre></div>
</div>
</div>
</div>
<div class="section" id="harmonize-chunks">
<h3>Harmonize chunks<a class="headerlink" href="#harmonize-chunks" title="Permalink to this headline">¶</a></h3>
<p>Some chunks are missing columns as certain land use types are not present. We need to harmonize our chunks to have the same columns in each of them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyarrow.parquet</span> <span class="k">as</span> <span class="nn">pq</span>

<span class="n">columns</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">103</span><span class="p">):</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">read_schema</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/functional/functional/func_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.pq&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
        <span class="n">columns</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">103</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/functional/functional/func_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.pq&quot;</span><span class="p">)</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">columns</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="n">missing</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/functional/functional/func_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.pq&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">function</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/functional/functional/func_*.pq&quot;</span><span class="p">)</span>
<span class="n">standardized</span> <span class="o">=</span> <span class="p">(</span><span class="n">function</span> <span class="o">-</span> <span class="n">function</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">function</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">min_max</span> <span class="o">=</span> <span class="p">(</span><span class="n">function</span> <span class="o">-</span> <span class="n">function</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">function</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">standardized</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/function/standardized/&quot;</span><span class="p">)</span>
<span class="n">min_max</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/function/normalized/&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 5min 35s, sys: 1min 39s, total: 7min 15s
Wall time: 3min 3s
</pre></div>
</div>
</div>
</div>
<p>Ensure that each observation has <code class="docutils literal notranslate"><span class="pre">hindex</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stand_fn</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/function/standardized/&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">standardized_form</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/form/standardized/&quot;</span><span class="p">)</span>
<span class="n">standardized_form</span><span class="p">[</span><span class="s1">&#39;hindex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stand_fn</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
<span class="n">standardized_form</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/form/standardized/&quot;</span><span class="p">)</span>

<span class="n">normalized_form</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/form/normalized/&quot;</span><span class="p">)</span>
<span class="n">normalized_form</span><span class="p">[</span><span class="s1">&#39;hindex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stand_fn</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
<span class="n">normalized_form</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/form/normalized/&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="test-cases">
<h2>Test cases<a class="headerlink" href="#test-cases" title="Permalink to this headline">¶</a></h2>
<p>Test cases:</p>
<ul class="simple">
<li><p>Chunk 68 - Glasgow 155609</p></li>
<li><p>Chunk 51 - Merseyside 121188</p></li>
<li><p>Random sample - 250000</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">standardized_form</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/form/standardized/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;hindex&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span> <span class="o">=</span> <span class="n">standardized_form</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">250_000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">sample</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/sample/form_standardized.pq&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">normalized_form</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/form/normalized/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;hindex&#39;</span><span class="p">)</span>
<span class="n">sample_norm</span> <span class="o">=</span> <span class="n">normalized_form</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sample</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
<span class="n">sample_norm</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/sample/form_normalized.pq&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stand_fn</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/function/standardized/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="n">sample_stand_fn</span> <span class="o">=</span> <span class="n">stand_fn</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sample</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
<span class="n">sample_stand_fn</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/sample/function_standardized.pq&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">norm_fn</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/function/normalized/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="n">sample_norm_fn</span> <span class="o">=</span> <span class="n">norm_fn</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sample</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
<span class="n">sample_norm_fn</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/sample/function_normalized.pq&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geoms</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/tessellation/tess_*.pq&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;hindex&quot;</span><span class="p">)</span>
<span class="n">sample_geoms</span> <span class="o">=</span> <span class="n">geoms</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sample</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
<span class="n">sample_geoms</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/sample/geometry.pq&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="evaluation">
<h2>Evaluation<a class="headerlink" href="#evaluation" title="Permalink to this headline">¶</a></h2>
<p>Link auxillary data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">tobler</span>
<span class="kn">import</span> <span class="nn">rioxarray</span>
<span class="kn">import</span> <span class="nn">rasterstats</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">parts</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">parts</span><span class="p">[</span><span class="s2">&quot;chunk51&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/tessellation/tess_51.pq&quot;</span><span class="p">)</span>
<span class="n">parts</span><span class="p">[</span><span class="s2">&quot;chunk68&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/tessellation/tess_68.pq&quot;</span><span class="p">)</span>
<span class="n">parts</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/sample/geometry.pq&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;tessellation&quot;</span><span class="p">])</span>
<span class="n">parts</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">])</span>
<span class="n">parts</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">][</span><span class="s2">&quot;tessellation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="o">.</span><span class="n">from_wkb</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tessellation</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="mi">27700</span><span class="p">)</span>
<span class="n">parts</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_geometry</span><span class="p">(</span><span class="s2">&quot;tessellation&quot;</span><span class="p">)</span>


<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">gdf</span> <span class="ow">in</span> <span class="n">parts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">murray</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/validation/murray.gpkg&quot;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">gdf</span><span class="o">.</span><span class="n">total_bounds</span><span class="p">))</span>
    <span class="n">murray</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">murray</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="n">cap_style</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">joined</span> <span class="o">=</span> <span class="n">tobler</span><span class="o">.</span><span class="n">area_weighted</span><span class="o">.</span><span class="n">area_join</span><span class="p">(</span><span class="n">murray</span><span class="p">,</span> <span class="n">gdf</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ward&quot;</span><span class="p">])</span>
    <span class="n">joined</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[[</span><span class="s2">&quot;hindex&quot;</span><span class="p">,</span> <span class="s1">&#39;ward&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/validation/murray_</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">.pq&quot;</span><span class="p">)</span>
    
    <span class="n">modum</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/validation/modumew2016.zip&quot;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">gdf</span><span class="o">.</span><span class="n">total_bounds</span><span class="p">))</span>
    <span class="n">joined</span> <span class="o">=</span> <span class="n">tobler</span><span class="o">.</span><span class="n">area_weighted</span><span class="o">.</span><span class="n">area_join</span><span class="p">(</span><span class="n">modum</span><span class="p">,</span> <span class="n">gdf</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;CLUSTER_LA&quot;</span><span class="p">])</span>
    <span class="n">joined</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[[</span><span class="s2">&quot;hindex&quot;</span><span class="p">,</span> <span class="s1">&#39;CLUSTER_LA&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/validation/modum_</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">.pq&quot;</span><span class="p">)</span>
    
    <span class="n">foot</span> <span class="o">=</span> <span class="n">rioxarray</span><span class="o">.</span><span class="n">open_rasterio</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/validation/jochem.tif&quot;</span><span class="p">)</span>
    <span class="n">foot_osgb</span> <span class="o">=</span> <span class="n">foot</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">reproject</span><span class="p">(</span><span class="s2">&quot;EPSG:27700&quot;</span><span class="p">)</span>
    <span class="n">clipped</span> <span class="o">=</span> <span class="n">foot_osgb</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">clip_box</span><span class="p">(</span><span class="o">*</span><span class="n">gdf</span><span class="o">.</span><span class="n">total_bounds</span><span class="p">)</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">clipped</span><span class="o">.</span><span class="n">values</span>
    <span class="n">affine</span> <span class="o">=</span> <span class="n">clipped</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">rasterstats</span><span class="o">.</span><span class="n">zonal_stats</span><span class="p">(</span>
        <span class="n">gdf</span><span class="o">.</span><span class="n">representative_point</span><span class="p">(),</span> 
        <span class="n">raster</span><span class="o">=</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">affine</span><span class="o">=</span><span class="n">affine</span><span class="p">,</span>
        <span class="n">stats</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span>
        <span class="n">nodata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;jochem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">]</span>
    <span class="n">gdf</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[[</span><span class="s2">&quot;hindex&quot;</span><span class="p">,</span> <span class="s1">&#39;jochem&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/validation/jochem_</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">.pq&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Part </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> done.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/conda/lib/python3.8/site-packages/geopandas/geodataframe.py:577: RuntimeWarning: Sequential read of iterator was interrupted. Resetting iterator. This can negatively impact the performance.
  for feature in features_lst:
/opt/conda/lib/python3.8/site-packages/tobler/area_weighted/area_join.py:63: UserWarning: Cannot preserve dtype of &#39;ward&#39;. Falling back to `dtype=object`.
  warnings.warn(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Part sample done.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">evaluation</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">case</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">murray</span><span class="p">,</span> <span class="n">modum</span><span class="p">,</span> <span class="n">jochem</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">sample_size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get evaluation metrics for a given clustering</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        data : array</span>
<span class="sd">        labels : array</span>
<span class="sd">        case : string {&quot;chunks&quot;, &quot;sample&quot;}</span>
<span class="sd">        identifier : ID of clustering model</span>
<span class="sd">        sample_size : int (silhouette_score sample size)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">contextily</span> <span class="k">as</span> <span class="nn">ctx</span>
    <span class="kn">import</span> <span class="nn">urbangrammar_graphics</span> <span class="k">as</span> <span class="nn">ugg</span>
    <span class="kn">import</span> <span class="nn">dask_geopandas</span>
    <span class="kn">from</span> <span class="nn">utils.dask_geopandas</span> <span class="kn">import</span> <span class="n">dask_dissolve</span>
    
    
    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;silhouette&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">silhouette_score</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">sample_size</span><span class="o">=</span><span class="n">sample_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;silhouette&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;calinski&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">calinski_harabasz_score</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;davies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">davies_bouldin_score</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>

    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;frequencies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
    
    <span class="c1"># cross tabulation</span>

    <span class="n">modum</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span>
    <span class="n">mod_crosstab</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">modum</span><span class="o">.</span><span class="n">dropna</span><span class="p">()[</span><span class="s1">&#39;labels&#39;</span><span class="p">],</span> <span class="n">modum</span><span class="o">.</span><span class="n">dropna</span><span class="p">()[</span><span class="s2">&quot;CLUSTER_LA&quot;</span><span class="p">])</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;mod_chi&#39;</span><span class="p">],</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;mod_p&#39;</span><span class="p">],</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;mod_dof&#39;</span><span class="p">],</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;mod_exp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">chi2_contingency</span><span class="p">(</span><span class="n">mod_crosstab</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;mod_cramers_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cramers_v</span><span class="p">(</span><span class="n">mod_crosstab</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;mod_crosstab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mod_crosstab</span>

    <span class="n">murray</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span>
    <span class="n">mur_crosstab</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">murray</span><span class="o">.</span><span class="n">dropna</span><span class="p">()[</span><span class="s1">&#39;labels&#39;</span><span class="p">],</span> <span class="n">murray</span><span class="o">.</span><span class="n">dropna</span><span class="p">()[</span><span class="s2">&quot;ward&quot;</span><span class="p">])</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;mur_chi&#39;</span><span class="p">],</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;mur_p&#39;</span><span class="p">],</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;mur_dof&#39;</span><span class="p">],</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;mur_exp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">chi2_contingency</span><span class="p">(</span><span class="n">mur_crosstab</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;mur_cramers_v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cramers_v</span><span class="p">(</span><span class="n">mur_crosstab</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;mur_crosstab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mur_crosstab</span>


    <span class="n">jochem</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span>
    <span class="n">joc_crosstab</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">jochem</span><span class="o">.</span><span class="n">dropna</span><span class="p">()[</span><span class="s1">&#39;labels&#39;</span><span class="p">],</span> <span class="n">jochem</span><span class="o">.</span><span class="n">dropna</span><span class="p">()[</span><span class="s2">&quot;jochem&quot;</span><span class="p">])</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;joc_chi&#39;</span><span class="p">],</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;joc_p&#39;</span><span class="p">],</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;joc_dof&#39;</span><span class="p">],</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;joc_exp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">chi2_contingency</span><span class="p">(</span><span class="n">joc_crosstab</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;joc_cramers_v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cramers_v</span><span class="p">(</span><span class="n">joc_crosstab</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;joc_crosstab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">joc_crosstab</span>
    
    
    <span class="k">if</span> <span class="n">case</span> <span class="o">==</span> <span class="s2">&quot;chunks&quot;</span><span class="p">:</span>
        <span class="c1"># signatures</span>
        
        <span class="n">geom</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span>        
        <span class="n">ddf</span> <span class="o">=</span> <span class="n">dask_geopandas</span><span class="o">.</span><span class="n">from_geopandas</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;labels&#39;</span><span class="p">),</span> <span class="n">npartitions</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>
        <span class="n">spsig</span> <span class="o">=</span> <span class="n">dask_dissolve</span><span class="p">(</span><span class="n">ddf</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s1">&#39;labels&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">explode</span><span class="p">()</span>
        
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;signature_abundance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spsig</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;signature_areas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spsig</span><span class="o">.</span><span class="n">area</span>
        
        
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">ugg</span><span class="o">.</span><span class="n">get_colormap</span><span class="p">(</span><span class="n">spsig</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">nunique</span><span class="p">(),</span> <span class="n">randomize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">token</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        
        <span class="n">ax</span> <span class="o">=</span> <span class="n">spsig</span><span class="o">.</span><span class="n">cx</span><span class="p">[</span><span class="mi">332971</span><span class="p">:</span><span class="mi">361675</span><span class="p">,</span> <span class="mi">379462</span><span class="p">:</span><span class="mi">404701</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s2">&quot;labels&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">.3</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">categorical</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="mi">27700</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">ugg</span><span class="o">.</span><span class="n">get_tiles</span><span class="p">(</span><span class="s1">&#39;roads&#39;</span><span class="p">,</span> <span class="n">token</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.3</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="mi">27700</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">ugg</span><span class="o">.</span><span class="n">get_tiles</span><span class="p">(</span><span class="s1">&#39;labels&#39;</span><span class="p">,</span> <span class="n">token</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="mi">27700</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">ugg</span><span class="o">.</span><span class="n">get_tiles</span><span class="p">(</span><span class="s1">&#39;background&#39;</span><span class="p">,</span> <span class="n">token</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/validation/maps/</span><span class="si">{</span><span class="n">identifier</span><span class="si">}</span><span class="s2">_lpool.png&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>   

        <span class="n">ax</span> <span class="o">=</span> <span class="n">spsig</span><span class="o">.</span><span class="n">cx</span><span class="p">[</span><span class="mi">218800</span><span class="p">:</span><span class="mi">270628</span><span class="p">,</span> <span class="mi">645123</span><span class="p">:</span><span class="mi">695069</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s2">&quot;labels&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">.3</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">categorical</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="mi">27700</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">ugg</span><span class="o">.</span><span class="n">get_tiles</span><span class="p">(</span><span class="s1">&#39;roads&#39;</span><span class="p">,</span> <span class="n">token</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.3</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="mi">27700</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">ugg</span><span class="o">.</span><span class="n">get_tiles</span><span class="p">(</span><span class="s1">&#39;labels&#39;</span><span class="p">,</span> <span class="n">token</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="mi">27700</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">ugg</span><span class="o">.</span><span class="n">get_tiles</span><span class="p">(</span><span class="s1">&#39;background&#39;</span><span class="p">,</span> <span class="n">token</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/validation/maps/</span><span class="si">{</span><span class="n">identifier</span><span class="si">}</span><span class="s2">_gla.png&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>    
    
<span class="c1">#     else:</span>
        
<span class="c1">#         geom[&#39;labels&#39;] = labels        </span>
<span class="c1">#         ddf = dask_geopandas.from_geopandas(geom.sort_values(&#39;labels&#39;), npartitions=64)</span>
<span class="c1">#         spsig = dask_dissolve(ddf, by=&#39;labels&#39;).compute().reset_index().explode()</span>
<span class="c1">#         centroid = spsig.centroid</span>
<span class="c1">#         results[&#39;x_coords&#39;] = centroid.x</span>
<span class="c1">#         results[&#39;y_coords &#39;]= centroid.y</span>
        
    <span class="k">return</span> <span class="n">results</span>


<span class="k">def</span> <span class="nf">cramers_v</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    
    <span class="n">chi2</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">chi2_contingency</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">phi2</span> <span class="o">=</span> <span class="n">chi2</span><span class="o">/</span><span class="n">n</span>
    <span class="n">r</span><span class="p">,</span><span class="n">k</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">phi2corr</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">phi2</span><span class="o">-</span><span class="p">((</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">rcorr</span> <span class="o">=</span> <span class="n">r</span><span class="o">-</span><span class="p">((</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">kcorr</span> <span class="o">=</span> <span class="n">k</span><span class="o">-</span><span class="p">((</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">phi2corr</span><span class="o">/</span><span class="nb">min</span><span class="p">((</span><span class="n">kcorr</span><span class="o">-</span><span class="mi">1</span><span class="p">),(</span><span class="n">rcorr</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">transformation</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;normalized&quot;</span><span class="p">,</span> <span class="s2">&quot;standardized&quot;</span><span class="p">]:</span>
    <span class="n">c51</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/form/</span><span class="si">{</span><span class="n">transformation</span><span class="si">}</span><span class="s2">/part.51.parquet&quot;</span><span class="p">)</span>
    <span class="n">c68</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/form/</span><span class="si">{</span><span class="n">transformation</span><span class="si">}</span><span class="s2">/part.68.parquet&quot;</span><span class="p">)</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">c51</span><span class="p">,</span> <span class="n">c68</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;hindex&quot;</span><span class="p">)</span>

    <span class="n">c51f</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/function/</span><span class="si">{</span><span class="n">transformation</span><span class="si">}</span><span class="s2">/part.51.parquet&quot;</span><span class="p">)</span>
    <span class="n">c68f</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/function/</span><span class="si">{</span><span class="n">transformation</span><span class="si">}</span><span class="s2">/part.68.parquet&quot;</span><span class="p">)</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">c51f</span><span class="p">,</span> <span class="n">c68f</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">form</span><span class="p">,</span> <span class="n">fn</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/sample/chunks_</span><span class="si">{</span><span class="n">transformation</span><span class="si">}</span><span class="s2">_data.pq&quot;</span><span class="p">)</span>
    
    <span class="n">form</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/sample/form_</span><span class="si">{</span><span class="n">transformation</span><span class="si">}</span><span class="s2">.pq&quot;</span><span class="p">)</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/sample/function_</span><span class="si">{</span><span class="n">transformation</span><span class="si">}</span><span class="s2">.pq&quot;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">form</span><span class="p">,</span> <span class="n">fn</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/sample/sample_</span><span class="si">{</span><span class="n">transformation</span><span class="si">}</span><span class="s2">_data.pq&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="test-matrix">
<h2>Test matrix<a class="headerlink" href="#test-matrix" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># !pip install scikit-learn-extra</span>
<span class="c1"># !pip install minisom</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>

<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span><span class="p">,</span> <span class="n">MiniBatchKMeans</span>
<span class="kn">from</span> <span class="nn">sklearn.mixture</span> <span class="kn">import</span> <span class="n">GaussianMixture</span>
<span class="kn">from</span> <span class="nn">sklearn_extra.cluster</span> <span class="kn">import</span> <span class="n">KMedoids</span>
<span class="kn">from</span> <span class="nn">minisom</span> <span class="kn">import</span> <span class="n">MiniSom</span>


<span class="n">labels</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">times</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">evaluations</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">quant_errors</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for case in [&quot;chunks&quot;, &quot;sample&quot;]:</span>
<span class="k">for</span> <span class="n">case</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]:</span>
    
    <span class="k">if</span> <span class="n">case</span> <span class="o">==</span> <span class="s2">&quot;chunks&quot;</span><span class="p">:</span>
        <span class="n">mod51</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/validation/modum_chunk51.pq&quot;</span><span class="p">)</span>
        <span class="n">mod68</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/validation/modum_chunk68.pq&quot;</span><span class="p">)</span>
        <span class="n">modum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">mod51</span><span class="p">,</span> <span class="n">mod68</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">mur51</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/validation/murray_chunk51.pq&quot;</span><span class="p">)</span>
        <span class="n">mur68</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/validation/murray_chunk68.pq&quot;</span><span class="p">)</span>
        <span class="n">murray</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">mur51</span><span class="p">,</span> <span class="n">mur68</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">joc51</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/validation/jochem_chunk51.pq&quot;</span><span class="p">)</span>
        <span class="n">joc68</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/validation/jochem_chunk68.pq&quot;</span><span class="p">)</span>
        <span class="n">jochem</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">joc51</span><span class="p">,</span> <span class="n">joc68</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">geom51</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/tessellation/tess_51.pq&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;tessellation&quot;</span><span class="p">,</span> <span class="s2">&quot;hindex&quot;</span><span class="p">])</span>
        <span class="n">geom68</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/tessellation/tess_68.pq&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;tessellation&quot;</span><span class="p">,</span> <span class="s2">&quot;hindex&quot;</span><span class="p">])</span>
        <span class="n">geom</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">geom51</span><span class="p">,</span> <span class="n">geom68</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">rename_geometry</span><span class="p">(</span><span class="s2">&quot;geometry&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">modum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/validation/modum_sample.pq&quot;</span><span class="p">)</span>
        <span class="n">murray</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/validation/murray_sample.pq&quot;</span><span class="p">)</span>
        <span class="n">jochem</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/validation/jochem_sample.pq&quot;</span><span class="p">)</span>
        <span class="n">geom</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/sample/geometry.pq&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;tessellation&quot;</span><span class="p">,</span> <span class="s2">&quot;hindex&quot;</span><span class="p">])</span>
        <span class="n">geom</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="o">.</span><span class="n">from_wkb</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">tessellation</span><span class="p">))</span>

<span class="c1">#     for transformation in [&quot;normalized&quot;, &quot;standardized&quot;]:</span>
    <span class="k">for</span> <span class="n">transformation</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;standardized&quot;</span><span class="p">]:</span>
        
        <span class="c1"># load data and prepare numpy.array</span>
        <span class="k">if</span> <span class="n">case</span> <span class="o">==</span> <span class="s2">&quot;chunks&quot;</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/sample/chunks_</span><span class="si">{</span><span class="n">transformation</span><span class="si">}</span><span class="s2">_data.pq&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/sample/sample_</span><span class="si">{</span><span class="n">transformation</span><span class="si">}</span><span class="s2">_data.pq&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span> 

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]:</span>
            <span class="c1"># KMeans</span>
            <span class="n">identifier</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">case</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">transformation</span><span class="si">}</span><span class="s2">_KMeans_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
            <span class="n">km</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">n_init</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">times</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">s</span>
            <span class="n">labels_</span> <span class="o">=</span> <span class="n">km</span><span class="o">.</span><span class="n">labels_</span>
            <span class="n">labels</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels_</span>
            
            <span class="n">evaluations</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">evaluation</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels_</span><span class="p">,</span> <span class="n">case</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">murray</span><span class="p">,</span> <span class="n">modum</span><span class="p">,</span> <span class="n">jochem</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">sample_size</span><span class="o">=</span><span class="mi">10_000</span><span class="p">)</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">identifier</span><span class="si">}</span><span class="s2"> done. Time to fit the model: </span><span class="si">{</span><span class="n">times</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span><span class="si">}</span><span class="s2"> seconds.&quot;</span><span class="p">)</span>
            
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]:</span>
            <span class="c1"># MiniBatchKMeans</span>
            <span class="n">identifier</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">case</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">transformation</span><span class="si">}</span><span class="s2">_MiniBatchKMeans_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
            <span class="n">km</span> <span class="o">=</span> <span class="n">MiniBatchKMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">25_000</span><span class="p">,</span> <span class="n">n_init</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">times</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">s</span>
            <span class="n">labels_</span> <span class="o">=</span> <span class="n">km</span><span class="o">.</span><span class="n">labels_</span>
            <span class="n">labels</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels_</span>
            
            <span class="n">evaluations</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">evaluation</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels_</span><span class="p">,</span> <span class="n">case</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">murray</span><span class="p">,</span> <span class="n">modum</span><span class="p">,</span> <span class="n">jochem</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">sample_size</span><span class="o">=</span><span class="mi">10_000</span><span class="p">)</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">identifier</span><span class="si">}</span><span class="s2"> done. Time to fit the model: </span><span class="si">{</span><span class="n">times</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span><span class="si">}</span><span class="s2"> seconds.&quot;</span><span class="p">)</span>
            
<span class="c1">#         for k in [10, 15, 20, 30]:</span>
<span class="c1">#             # K-Medoid</span>
<span class="c1">#             identifier = f&quot;{case}_{transformation}_KMedoid_{k}&quot;</span>
<span class="c1">#             s = time()</span>
<span class="c1">#             km = KMedoids(n_clusters=k, random_state=42).fit(data)</span>
<span class="c1">#             times[identifier] = time() - s</span>
<span class="c1">#             labels_ = km.labels_</span>
<span class="c1">#             labels[identifier] = labels_</span>
            
<span class="c1">#             evaluations[identifier] = evaluation(data, labels_, case, identifier, murray, modum, jochem, geom, sample_size=10_000)</span>
            
<span class="c1">#             print(f&quot;{identifier} done. Time to fit the model: {times[identifier]} seconds.&quot;)</span>
        
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]:</span>
            <span class="c1"># GMM</span>
            <span class="n">identifier</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">case</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">transformation</span><span class="si">}</span><span class="s2">_GMM_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
            <span class="n">gmm</span> <span class="o">=</span> <span class="n">GaussianMixture</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">n_init</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">covariance_type</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">times</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">s</span>
            <span class="n">labels_</span> <span class="o">=</span> <span class="n">gmm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">labels</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels_</span>
            
            <span class="n">evaluations</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">evaluation</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels_</span><span class="p">,</span> <span class="n">case</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">murray</span><span class="p">,</span> <span class="n">modum</span><span class="p">,</span> <span class="n">jochem</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">sample_size</span><span class="o">=</span><span class="mi">10_000</span><span class="p">)</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">identifier</span><span class="si">}</span><span class="s2"> done. Time to fit the model: </span><span class="si">{</span><span class="n">times</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span><span class="si">}</span><span class="s2"> seconds.&quot;</span><span class="p">)</span>

        <span class="c1"># SOM</span>
        <span class="k">for</span> <span class="n">som_shape</span> <span class="ow">in</span> <span class="p">[(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">rate</span><span class="p">)</span> <span class="ow">in</span> <span class="n">product</span><span class="p">([</span><span class="mf">.01</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="mf">.25</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mf">.01</span><span class="p">,</span> <span class="mf">.05</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="mf">.2</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]):</span>
                <span class="n">identifier</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">case</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">transformation</span><span class="si">}</span><span class="s2">_SOM_</span><span class="si">{</span><span class="n">som_shape</span><span class="si">}</span><span class="s2">_sigma-</span><span class="si">{</span><span class="n">sigma</span><span class="si">}</span><span class="s2">_rate-</span><span class="si">{</span><span class="n">rate</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
                <span class="n">som</span> <span class="o">=</span> <span class="n">MiniSom</span><span class="p">(</span><span class="n">som_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">som_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="n">rate</span><span class="p">,</span>
                              <span class="n">topology</span><span class="o">=</span><span class="s2">&quot;hexagonal&quot;</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
                <span class="n">som</span><span class="o">.</span><span class="n">train_batch</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">50000</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">winner_coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">som</span><span class="o">.</span><span class="n">winner</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">])</span>
                <span class="n">labels_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">winner_coordinates</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels_</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">times</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">s</span>
                    <span class="n">labels</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels_</span>

                    <span class="n">evaluations</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">evaluation</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels_</span><span class="p">,</span> <span class="n">case</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">murray</span><span class="p">,</span> <span class="n">modum</span><span class="p">,</span> <span class="n">jochem</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">sample_size</span><span class="o">=</span><span class="mi">10_000</span><span class="p">)</span>
                    <span class="n">quant_errors</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">som</span><span class="o">.</span><span class="n">quantization_error</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">identifier</span><span class="si">}</span><span class="s2"> done. Time to fit the model: </span><span class="si">{</span><span class="n">times</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span><span class="si">}</span><span class="s2"> seconds.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>sample_standardized_KMeans_10 done. Time to fit the model: 33.980648040771484 seconds.
sample_standardized_KMeans_15 done. Time to fit the model: 36.58458423614502 seconds.
sample_standardized_KMeans_20 done. Time to fit the model: 50.62095856666565 seconds.
sample_standardized_KMeans_30 done. Time to fit the model: 88.40085291862488 seconds.
sample_standardized_MiniBatchKMeans_10 done. Time to fit the model: 17.53959631919861 seconds.
sample_standardized_MiniBatchKMeans_15 done. Time to fit the model: 19.377883672714233 seconds.
sample_standardized_MiniBatchKMeans_20 done. Time to fit the model: 19.961794137954712 seconds.
sample_standardized_MiniBatchKMeans_30 done. Time to fit the model: 27.228529930114746 seconds.
sample_standardized_GMM_10 done. Time to fit the model: 8817.877690076828 seconds.
sample_standardized_GMM_15 done. Time to fit the model: 8004.2522094249725 seconds.
sample_standardized_GMM_20 done. Time to fit the model: 11593.263016223907 seconds.
sample_standardized_GMM_30 done. Time to fit the model: 21957.19268512726 seconds.
sample_standardized_SOM_(3, 3)_sigma-0.01_rate-0.01 done. Time to fit the model: 6.041452169418335 seconds.
sample_standardized_SOM_(3, 3)_sigma-0.01_rate-0.05 done. Time to fit the model: 6.0424699783325195 seconds.
sample_standardized_SOM_(3, 3)_sigma-0.01_rate-0.1 done. Time to fit the model: 6.0597083568573 seconds.
sample_standardized_SOM_(3, 3)_sigma-0.01_rate-0.2 done. Time to fit the model: 6.382687568664551 seconds.
sample_standardized_SOM_(3, 3)_sigma-0.01_rate-0.5 done. Time to fit the model: 6.059550046920776 seconds.
sample_standardized_SOM_(3, 3)_sigma-0.01_rate-1 done. Time to fit the model: 6.28273344039917 seconds.
sample_standardized_SOM_(3, 3)_sigma-0.1_rate-0.01 done. Time to fit the model: 6.27402925491333 seconds.
sample_standardized_SOM_(3, 3)_sigma-0.1_rate-0.05 done. Time to fit the model: 6.091947555541992 seconds.
sample_standardized_SOM_(3, 3)_sigma-0.1_rate-0.1 done. Time to fit the model: 6.291349411010742 seconds.
sample_standardized_SOM_(3, 3)_sigma-0.1_rate-0.2 done. Time to fit the model: 6.2743775844573975 seconds.
sample_standardized_SOM_(3, 3)_sigma-0.1_rate-0.5 done. Time to fit the model: 6.125728130340576 seconds.
sample_standardized_SOM_(3, 3)_sigma-0.1_rate-1 done. Time to fit the model: 6.091755628585815 seconds.
sample_standardized_SOM_(3, 3)_sigma-0.25_rate-0.01 done. Time to fit the model: 6.207939147949219 seconds.
sample_standardized_SOM_(3, 3)_sigma-0.25_rate-0.05 done. Time to fit the model: 6.399035930633545 seconds.
sample_standardized_SOM_(3, 3)_sigma-0.25_rate-0.1 done. Time to fit the model: 6.149229049682617 seconds.
sample_standardized_SOM_(3, 3)_sigma-0.25_rate-0.2 done. Time to fit the model: 6.255995750427246 seconds.
sample_standardized_SOM_(3, 3)_sigma-0.25_rate-0.5 done. Time to fit the model: 6.120840549468994 seconds.
sample_standardized_SOM_(3, 3)_sigma-0.25_rate-1 done. Time to fit the model: 6.245414733886719 seconds.
sample_standardized_SOM_(3, 3)_sigma-0.5_rate-0.01 done. Time to fit the model: 5.998126745223999 seconds.
sample_standardized_SOM_(3, 3)_sigma-0.5_rate-0.05 done. Time to fit the model: 6.2665159702301025 seconds.
sample_standardized_SOM_(3, 3)_sigma-0.5_rate-0.1 done. Time to fit the model: 6.202017545700073 seconds.
sample_standardized_SOM_(3, 3)_sigma-0.5_rate-0.2 done. Time to fit the model: 6.271490812301636 seconds.
sample_standardized_SOM_(3, 3)_sigma-0.5_rate-0.5 done. Time to fit the model: 6.278396368026733 seconds.
sample_standardized_SOM_(3, 3)_sigma-0.5_rate-1 done. Time to fit the model: 6.106752872467041 seconds.
sample_standardized_SOM_(3, 3)_sigma-1_rate-0.01 done. Time to fit the model: 6.008735656738281 seconds.
sample_standardized_SOM_(3, 3)_sigma-1_rate-0.05 done. Time to fit the model: 6.033384323120117 seconds.
sample_standardized_SOM_(3, 3)_sigma-1_rate-0.1 done. Time to fit the model: 6.1437554359436035 seconds.
sample_standardized_SOM_(3, 3)_sigma-1_rate-0.2 done. Time to fit the model: 6.351598739624023 seconds.
sample_standardized_SOM_(3, 3)_sigma-1_rate-0.5 done. Time to fit the model: 6.337004899978638 seconds.
sample_standardized_SOM_(3, 3)_sigma-1_rate-1 done. Time to fit the model: 6.048030853271484 seconds.
sample_standardized_SOM_(2, 5)_sigma-0.01_rate-0.01 done. Time to fit the model: 6.246315956115723 seconds.
sample_standardized_SOM_(2, 5)_sigma-0.01_rate-0.05 done. Time to fit the model: 6.338611841201782 seconds.
sample_standardized_SOM_(2, 5)_sigma-0.01_rate-0.1 done. Time to fit the model: 6.214588403701782 seconds.
sample_standardized_SOM_(2, 5)_sigma-0.01_rate-0.2 done. Time to fit the model: 6.299610137939453 seconds.
sample_standardized_SOM_(2, 5)_sigma-0.01_rate-0.5 done. Time to fit the model: 6.38018798828125 seconds.
sample_standardized_SOM_(2, 5)_sigma-0.01_rate-1 done. Time to fit the model: 6.186944007873535 seconds.
sample_standardized_SOM_(2, 5)_sigma-0.1_rate-0.01 done. Time to fit the model: 6.1516852378845215 seconds.
sample_standardized_SOM_(2, 5)_sigma-0.1_rate-0.05 done. Time to fit the model: 6.371593952178955 seconds.
sample_standardized_SOM_(2, 5)_sigma-0.1_rate-0.1 done. Time to fit the model: 6.331070899963379 seconds.
sample_standardized_SOM_(2, 5)_sigma-0.1_rate-0.2 done. Time to fit the model: 6.6916892528533936 seconds.
sample_standardized_SOM_(2, 5)_sigma-0.1_rate-0.5 done. Time to fit the model: 6.45002007484436 seconds.
sample_standardized_SOM_(2, 5)_sigma-0.1_rate-1 done. Time to fit the model: 6.447925567626953 seconds.
sample_standardized_SOM_(2, 5)_sigma-0.25_rate-0.01 done. Time to fit the model: 6.230453252792358 seconds.
sample_standardized_SOM_(2, 5)_sigma-0.25_rate-0.05 done. Time to fit the model: 6.4163124561309814 seconds.
sample_standardized_SOM_(2, 5)_sigma-0.25_rate-0.1 done. Time to fit the model: 6.312195301055908 seconds.
sample_standardized_SOM_(2, 5)_sigma-0.25_rate-0.2 done. Time to fit the model: 6.496335744857788 seconds.
sample_standardized_SOM_(2, 5)_sigma-0.25_rate-0.5 done. Time to fit the model: 6.320337533950806 seconds.
sample_standardized_SOM_(2, 5)_sigma-0.25_rate-1 done. Time to fit the model: 6.391258239746094 seconds.
sample_standardized_SOM_(2, 5)_sigma-0.5_rate-0.01 done. Time to fit the model: 6.227715969085693 seconds.
sample_standardized_SOM_(2, 5)_sigma-0.5_rate-0.05 done. Time to fit the model: 6.272166013717651 seconds.
sample_standardized_SOM_(2, 5)_sigma-0.5_rate-0.1 done. Time to fit the model: 6.29688572883606 seconds.
sample_standardized_SOM_(2, 5)_sigma-0.5_rate-0.2 done. Time to fit the model: 6.512700319290161 seconds.
sample_standardized_SOM_(2, 5)_sigma-0.5_rate-0.5 done. Time to fit the model: 6.449718236923218 seconds.
sample_standardized_SOM_(2, 5)_sigma-0.5_rate-1 done. Time to fit the model: 6.2205281257629395 seconds.
sample_standardized_SOM_(2, 5)_sigma-1_rate-0.01 done. Time to fit the model: 6.2186102867126465 seconds.
sample_standardized_SOM_(2, 5)_sigma-1_rate-0.05 done. Time to fit the model: 6.249726295471191 seconds.
sample_standardized_SOM_(2, 5)_sigma-1_rate-0.1 done. Time to fit the model: 6.2725629806518555 seconds.
sample_standardized_SOM_(2, 5)_sigma-1_rate-0.2 done. Time to fit the model: 6.410464763641357 seconds.
sample_standardized_SOM_(2, 5)_sigma-1_rate-0.5 done. Time to fit the model: 6.647894382476807 seconds.
sample_standardized_SOM_(2, 5)_sigma-1_rate-1 done. Time to fit the model: 6.202193737030029 seconds.
sample_standardized_SOM_(3, 4)_sigma-0.01_rate-0.01 done. Time to fit the model: 6.466960906982422 seconds.
sample_standardized_SOM_(3, 4)_sigma-0.01_rate-0.05 done. Time to fit the model: 6.4868175983428955 seconds.
sample_standardized_SOM_(3, 4)_sigma-0.01_rate-0.1 done. Time to fit the model: 6.603813648223877 seconds.
sample_standardized_SOM_(3, 4)_sigma-0.01_rate-0.2 done. Time to fit the model: 6.70729660987854 seconds.
sample_standardized_SOM_(3, 4)_sigma-0.01_rate-0.5 done. Time to fit the model: 6.687565326690674 seconds.
sample_standardized_SOM_(3, 4)_sigma-0.01_rate-1 done. Time to fit the model: 6.6126062870025635 seconds.
sample_standardized_SOM_(3, 4)_sigma-0.1_rate-0.01 done. Time to fit the model: 6.622690200805664 seconds.
sample_standardized_SOM_(3, 4)_sigma-0.1_rate-0.05 done. Time to fit the model: 6.527747392654419 seconds.
sample_standardized_SOM_(3, 4)_sigma-0.1_rate-0.1 done. Time to fit the model: 8.404837846755981 seconds.
sample_standardized_SOM_(3, 4)_sigma-0.1_rate-0.2 done. Time to fit the model: 9.995216131210327 seconds.
sample_standardized_SOM_(3, 4)_sigma-0.1_rate-0.5 done. Time to fit the model: 8.759083271026611 seconds.
sample_standardized_SOM_(3, 4)_sigma-0.1_rate-1 done. Time to fit the model: 6.665789604187012 seconds.
sample_standardized_SOM_(3, 4)_sigma-0.25_rate-0.01 done. Time to fit the model: 6.517737150192261 seconds.
sample_standardized_SOM_(3, 4)_sigma-0.25_rate-0.05 done. Time to fit the model: 6.59808087348938 seconds.
sample_standardized_SOM_(3, 4)_sigma-0.25_rate-0.1 done. Time to fit the model: 6.585826396942139 seconds.
sample_standardized_SOM_(3, 4)_sigma-0.25_rate-0.2 done. Time to fit the model: 6.641624450683594 seconds.
sample_standardized_SOM_(3, 4)_sigma-0.25_rate-0.5 done. Time to fit the model: 8.689597129821777 seconds.
sample_standardized_SOM_(3, 4)_sigma-0.25_rate-1 done. Time to fit the model: 9.790433645248413 seconds.
sample_standardized_SOM_(3, 4)_sigma-0.5_rate-0.01 done. Time to fit the model: 8.342492580413818 seconds.
sample_standardized_SOM_(3, 4)_sigma-0.5_rate-0.05 done. Time to fit the model: 6.496647596359253 seconds.
sample_standardized_SOM_(3, 4)_sigma-0.5_rate-0.1 done. Time to fit the model: 6.587351083755493 seconds.
sample_standardized_SOM_(3, 4)_sigma-0.5_rate-0.2 done. Time to fit the model: 6.779898166656494 seconds.
sample_standardized_SOM_(3, 4)_sigma-0.5_rate-0.5 done. Time to fit the model: 6.784470319747925 seconds.
sample_standardized_SOM_(3, 4)_sigma-0.5_rate-1 done. Time to fit the model: 6.452801465988159 seconds.
sample_standardized_SOM_(3, 4)_sigma-1_rate-0.01 done. Time to fit the model: 6.6474609375 seconds.
sample_standardized_SOM_(3, 4)_sigma-1_rate-0.05 done. Time to fit the model: 6.5371527671813965 seconds.
sample_standardized_SOM_(3, 4)_sigma-1_rate-0.1 done. Time to fit the model: 6.913776159286499 seconds.
sample_standardized_SOM_(3, 4)_sigma-1_rate-0.2 done. Time to fit the model: 6.674077033996582 seconds.
sample_standardized_SOM_(3, 4)_sigma-1_rate-0.5 done. Time to fit the model: 6.895212173461914 seconds.
sample_standardized_SOM_(3, 4)_sigma-1_rate-1 done. Time to fit the model: 6.550818204879761 seconds.
sample_standardized_SOM_(2, 6)_sigma-0.01_rate-0.01 done. Time to fit the model: 6.406692743301392 seconds.
sample_standardized_SOM_(2, 6)_sigma-0.01_rate-0.05 done. Time to fit the model: 6.451681852340698 seconds.
sample_standardized_SOM_(2, 6)_sigma-0.01_rate-0.1 done. Time to fit the model: 6.651016712188721 seconds.
sample_standardized_SOM_(2, 6)_sigma-0.01_rate-0.2 done. Time to fit the model: 6.768008470535278 seconds.
sample_standardized_SOM_(2, 6)_sigma-0.01_rate-0.5 done. Time to fit the model: 6.5549585819244385 seconds.
sample_standardized_SOM_(2, 6)_sigma-0.01_rate-1 done. Time to fit the model: 6.604512453079224 seconds.
sample_standardized_SOM_(2, 6)_sigma-0.1_rate-0.01 done. Time to fit the model: 6.488897800445557 seconds.
sample_standardized_SOM_(2, 6)_sigma-0.1_rate-0.05 done. Time to fit the model: 6.474110841751099 seconds.
sample_standardized_SOM_(2, 6)_sigma-0.1_rate-0.1 done. Time to fit the model: 6.891201496124268 seconds.
sample_standardized_SOM_(2, 6)_sigma-0.1_rate-0.2 done. Time to fit the model: 6.849219799041748 seconds.
sample_standardized_SOM_(2, 6)_sigma-0.1_rate-0.5 done. Time to fit the model: 7.015116453170776 seconds.
sample_standardized_SOM_(2, 6)_sigma-0.1_rate-1 done. Time to fit the model: 6.593651533126831 seconds.
sample_standardized_SOM_(2, 6)_sigma-0.25_rate-0.01 done. Time to fit the model: 6.737154245376587 seconds.
sample_standardized_SOM_(2, 6)_sigma-0.25_rate-0.05 done. Time to fit the model: 8.17149806022644 seconds.
sample_standardized_SOM_(2, 6)_sigma-0.25_rate-0.1 done. Time to fit the model: 9.674012899398804 seconds.
sample_standardized_SOM_(2, 6)_sigma-0.25_rate-0.2 done. Time to fit the model: 8.839396953582764 seconds.
sample_standardized_SOM_(2, 6)_sigma-0.25_rate-0.5 done. Time to fit the model: 6.666623592376709 seconds.
sample_standardized_SOM_(2, 6)_sigma-0.25_rate-1 done. Time to fit the model: 6.6030731201171875 seconds.
sample_standardized_SOM_(2, 6)_sigma-0.5_rate-0.01 done. Time to fit the model: 6.458607912063599 seconds.
sample_standardized_SOM_(2, 6)_sigma-0.5_rate-0.05 done. Time to fit the model: 6.374103784561157 seconds.
sample_standardized_SOM_(2, 6)_sigma-0.5_rate-0.1 done. Time to fit the model: 6.520724058151245 seconds.
sample_standardized_SOM_(2, 6)_sigma-0.5_rate-0.2 done. Time to fit the model: 6.621204376220703 seconds.
sample_standardized_SOM_(2, 6)_sigma-0.5_rate-0.5 done. Time to fit the model: 6.6905903816223145 seconds.
sample_standardized_SOM_(2, 6)_sigma-0.5_rate-1 done. Time to fit the model: 6.467045783996582 seconds.
sample_standardized_SOM_(2, 6)_sigma-1_rate-0.01 done. Time to fit the model: 6.614234685897827 seconds.
sample_standardized_SOM_(2, 6)_sigma-1_rate-0.05 done. Time to fit the model: 6.433612108230591 seconds.
sample_standardized_SOM_(2, 6)_sigma-1_rate-0.1 done. Time to fit the model: 6.642040967941284 seconds.
sample_standardized_SOM_(2, 6)_sigma-1_rate-0.2 done. Time to fit the model: 6.810717821121216 seconds.
sample_standardized_SOM_(2, 6)_sigma-1_rate-0.5 done. Time to fit the model: 6.835365056991577 seconds.
sample_standardized_SOM_(2, 6)_sigma-1_rate-1 done. Time to fit the model: 6.449937343597412 seconds.
sample_standardized_SOM_(3, 5)_sigma-0.01_rate-0.01 done. Time to fit the model: 6.848511457443237 seconds.
sample_standardized_SOM_(3, 5)_sigma-0.01_rate-0.05 done. Time to fit the model: 6.851857423782349 seconds.
sample_standardized_SOM_(3, 5)_sigma-0.01_rate-0.1 done. Time to fit the model: 6.921448469161987 seconds.
sample_standardized_SOM_(3, 5)_sigma-0.01_rate-0.2 done. Time to fit the model: 7.021340370178223 seconds.
sample_standardized_SOM_(3, 5)_sigma-0.01_rate-0.5 done. Time to fit the model: 6.932762384414673 seconds.
sample_standardized_SOM_(3, 5)_sigma-0.01_rate-1 done. Time to fit the model: 7.124608039855957 seconds.
sample_standardized_SOM_(3, 5)_sigma-0.1_rate-0.01 done. Time to fit the model: 6.972275733947754 seconds.
sample_standardized_SOM_(3, 5)_sigma-0.1_rate-0.05 done. Time to fit the model: 7.044497013092041 seconds.
sample_standardized_SOM_(3, 5)_sigma-0.1_rate-0.1 done. Time to fit the model: 7.2646777629852295 seconds.
sample_standardized_SOM_(3, 5)_sigma-0.1_rate-0.2 done. Time to fit the model: 8.82405710220337 seconds.
sample_standardized_SOM_(3, 5)_sigma-0.1_rate-0.5 done. Time to fit the model: 10.416626453399658 seconds.
sample_standardized_SOM_(3, 5)_sigma-0.1_rate-1 done. Time to fit the model: 9.215104579925537 seconds.
sample_standardized_SOM_(3, 5)_sigma-0.25_rate-0.01 done. Time to fit the model: 8.639707326889038 seconds.
sample_standardized_SOM_(3, 5)_sigma-0.25_rate-0.05 done. Time to fit the model: 10.058373928070068 seconds.
sample_standardized_SOM_(3, 5)_sigma-0.25_rate-0.1 done. Time to fit the model: 8.89886999130249 seconds.
sample_standardized_SOM_(3, 5)_sigma-0.25_rate-0.2 done. Time to fit the model: 7.006105422973633 seconds.
sample_standardized_SOM_(3, 5)_sigma-0.25_rate-0.5 done. Time to fit the model: 7.002037286758423 seconds.
sample_standardized_SOM_(3, 5)_sigma-0.25_rate-1 done. Time to fit the model: 6.9071714878082275 seconds.
sample_standardized_SOM_(3, 5)_sigma-0.5_rate-0.01 done. Time to fit the model: 6.878051280975342 seconds.
sample_standardized_SOM_(3, 5)_sigma-0.5_rate-0.05 done. Time to fit the model: 6.978433847427368 seconds.
sample_standardized_SOM_(3, 5)_sigma-0.5_rate-0.1 done. Time to fit the model: 7.020828485488892 seconds.
sample_standardized_SOM_(3, 5)_sigma-0.5_rate-0.2 done. Time to fit the model: 7.195865869522095 seconds.
sample_standardized_SOM_(3, 5)_sigma-0.5_rate-0.5 done. Time to fit the model: 7.115154266357422 seconds.
sample_standardized_SOM_(3, 5)_sigma-0.5_rate-1 done. Time to fit the model: 7.015010356903076 seconds.
sample_standardized_SOM_(3, 5)_sigma-1_rate-0.01 done. Time to fit the model: 6.9420506954193115 seconds.
sample_standardized_SOM_(3, 5)_sigma-1_rate-0.05 done. Time to fit the model: 7.148162841796875 seconds.
sample_standardized_SOM_(3, 5)_sigma-1_rate-0.1 done. Time to fit the model: 7.281223773956299 seconds.
sample_standardized_SOM_(3, 5)_sigma-1_rate-0.2 done. Time to fit the model: 7.0804712772369385 seconds.
sample_standardized_SOM_(3, 5)_sigma-1_rate-0.5 done. Time to fit the model: 7.378613233566284 seconds.
sample_standardized_SOM_(3, 5)_sigma-1_rate-1 done. Time to fit the model: 7.000572204589844 seconds.
sample_standardized_SOM_(4, 5)_sigma-0.01_rate-0.01 done. Time to fit the model: 7.723738193511963 seconds.
sample_standardized_SOM_(4, 5)_sigma-0.01_rate-0.05 done. Time to fit the model: 7.72091817855835 seconds.
sample_standardized_SOM_(4, 5)_sigma-0.01_rate-0.1 done. Time to fit the model: 7.813778638839722 seconds.
sample_standardized_SOM_(4, 5)_sigma-0.01_rate-0.2 done. Time to fit the model: 7.847135543823242 seconds.
sample_standardized_SOM_(4, 5)_sigma-0.01_rate-0.5 done. Time to fit the model: 8.101349592208862 seconds.
sample_standardized_SOM_(4, 5)_sigma-0.01_rate-1 done. Time to fit the model: 7.922775506973267 seconds.
sample_standardized_SOM_(4, 5)_sigma-0.1_rate-0.01 done. Time to fit the model: 7.866520166397095 seconds.
sample_standardized_SOM_(4, 5)_sigma-0.1_rate-0.05 done. Time to fit the model: 7.924614191055298 seconds.
sample_standardized_SOM_(4, 5)_sigma-0.1_rate-0.1 done. Time to fit the model: 7.896871566772461 seconds.
sample_standardized_SOM_(4, 5)_sigma-0.1_rate-0.2 done. Time to fit the model: 7.926555156707764 seconds.
sample_standardized_SOM_(4, 5)_sigma-0.1_rate-0.5 done. Time to fit the model: 7.869636058807373 seconds.
sample_standardized_SOM_(4, 5)_sigma-0.1_rate-1 done. Time to fit the model: 8.035306930541992 seconds.
sample_standardized_SOM_(4, 5)_sigma-0.25_rate-0.01 done. Time to fit the model: 7.94612717628479 seconds.
sample_standardized_SOM_(4, 5)_sigma-0.25_rate-0.05 done. Time to fit the model: 7.792319059371948 seconds.
sample_standardized_SOM_(4, 5)_sigma-0.25_rate-0.1 done. Time to fit the model: 7.886402368545532 seconds.
sample_standardized_SOM_(4, 5)_sigma-0.25_rate-0.2 done. Time to fit the model: 7.945167303085327 seconds.
sample_standardized_SOM_(4, 5)_sigma-0.25_rate-0.5 done. Time to fit the model: 7.895480155944824 seconds.
sample_standardized_SOM_(4, 5)_sigma-0.25_rate-1 done. Time to fit the model: 8.203335523605347 seconds.
sample_standardized_SOM_(4, 5)_sigma-0.5_rate-0.01 done. Time to fit the model: 7.717268705368042 seconds.
sample_standardized_SOM_(4, 5)_sigma-0.5_rate-0.05 done. Time to fit the model: 7.8255932331085205 seconds.
sample_standardized_SOM_(4, 5)_sigma-0.5_rate-0.1 done. Time to fit the model: 8.04367995262146 seconds.
sample_standardized_SOM_(4, 5)_sigma-0.5_rate-0.2 done. Time to fit the model: 9.806514978408813 seconds.
sample_standardized_SOM_(4, 5)_sigma-0.5_rate-0.5 done. Time to fit the model: 11.029207229614258 seconds.
sample_standardized_SOM_(4, 5)_sigma-0.5_rate-1 done. Time to fit the model: 9.586603164672852 seconds.
sample_standardized_SOM_(4, 5)_sigma-1_rate-0.01 done. Time to fit the model: 7.6841535568237305 seconds.
sample_standardized_SOM_(4, 5)_sigma-1_rate-0.05 done. Time to fit the model: 7.742480993270874 seconds.
sample_standardized_SOM_(4, 5)_sigma-1_rate-0.1 done. Time to fit the model: 8.154315948486328 seconds.
sample_standardized_SOM_(4, 5)_sigma-1_rate-0.2 done. Time to fit the model: 9.876065254211426 seconds.
sample_standardized_SOM_(4, 5)_sigma-1_rate-0.5 done. Time to fit the model: 11.988449573516846 seconds.
sample_standardized_SOM_(4, 5)_sigma-1_rate-1 done. Time to fit the model: 9.684459686279297 seconds.
sample_standardized_SOM_(5, 5)_sigma-0.01_rate-0.01 done. Time to fit the model: 8.574947834014893 seconds.
sample_standardized_SOM_(5, 5)_sigma-0.01_rate-0.05 done. Time to fit the model: 8.547278642654419 seconds.
sample_standardized_SOM_(5, 5)_sigma-0.01_rate-0.1 done. Time to fit the model: 8.799760341644287 seconds.
sample_standardized_SOM_(5, 5)_sigma-0.01_rate-0.2 done. Time to fit the model: 8.887267827987671 seconds.
sample_standardized_SOM_(5, 5)_sigma-0.01_rate-0.5 done. Time to fit the model: 8.837449073791504 seconds.
sample_standardized_SOM_(5, 5)_sigma-0.01_rate-1 done. Time to fit the model: 8.59840703010559 seconds.
sample_standardized_SOM_(5, 5)_sigma-0.1_rate-0.01 done. Time to fit the model: 8.567549228668213 seconds.
sample_standardized_SOM_(5, 5)_sigma-0.1_rate-0.05 done. Time to fit the model: 8.490204811096191 seconds.
sample_standardized_SOM_(5, 5)_sigma-0.1_rate-0.1 done. Time to fit the model: 9.251555919647217 seconds.
sample_standardized_SOM_(5, 5)_sigma-0.1_rate-0.2 done. Time to fit the model: 8.830044507980347 seconds.
sample_standardized_SOM_(5, 5)_sigma-0.1_rate-0.5 done. Time to fit the model: 8.744437217712402 seconds.
sample_standardized_SOM_(5, 5)_sigma-0.1_rate-1 done. Time to fit the model: 10.71109390258789 seconds.
sample_standardized_SOM_(5, 5)_sigma-0.25_rate-0.01 done. Time to fit the model: 8.963495254516602 seconds.
sample_standardized_SOM_(5, 5)_sigma-0.25_rate-0.05 done. Time to fit the model: 8.572678327560425 seconds.
sample_standardized_SOM_(5, 5)_sigma-0.25_rate-0.1 done. Time to fit the model: 8.890587568283081 seconds.
sample_standardized_SOM_(5, 5)_sigma-0.25_rate-0.2 done. Time to fit the model: 8.855430364608765 seconds.
sample_standardized_SOM_(5, 5)_sigma-0.25_rate-0.5 done. Time to fit the model: 9.030456781387329 seconds.
sample_standardized_SOM_(5, 5)_sigma-0.25_rate-1 done. Time to fit the model: 8.97514533996582 seconds.
sample_standardized_SOM_(5, 5)_sigma-0.5_rate-0.01 done. Time to fit the model: 8.725110054016113 seconds.
sample_standardized_SOM_(5, 5)_sigma-0.5_rate-0.05 done. Time to fit the model: 8.969297409057617 seconds.
sample_standardized_SOM_(5, 5)_sigma-0.5_rate-0.1 done. Time to fit the model: 8.507286548614502 seconds.
sample_standardized_SOM_(5, 5)_sigma-0.5_rate-0.2 done. Time to fit the model: 11.285863161087036 seconds.
sample_standardized_SOM_(5, 5)_sigma-0.5_rate-0.5 done. Time to fit the model: 10.909534215927124 seconds.
sample_standardized_SOM_(5, 5)_sigma-0.5_rate-1 done. Time to fit the model: 8.99370288848877 seconds.
sample_standardized_SOM_(5, 5)_sigma-1_rate-0.01 done. Time to fit the model: 8.653746128082275 seconds.
sample_standardized_SOM_(5, 5)_sigma-1_rate-0.05 done. Time to fit the model: 8.670263767242432 seconds.
sample_standardized_SOM_(5, 5)_sigma-1_rate-0.1 done. Time to fit the model: 8.526506185531616 seconds.
sample_standardized_SOM_(5, 5)_sigma-1_rate-0.2 done. Time to fit the model: 8.697363138198853 seconds.
sample_standardized_SOM_(5, 5)_sigma-1_rate-0.5 done. Time to fit the model: 9.55558180809021 seconds.
sample_standardized_SOM_(5, 5)_sigma-1_rate-1 done. Time to fit the model: 8.891328811645508 seconds.
sample_standardized_SOM_(6, 5)_sigma-0.01_rate-0.01 done. Time to fit the model: 11.544363021850586 seconds.
sample_standardized_SOM_(6, 5)_sigma-0.01_rate-0.05 done. Time to fit the model: 14.227508068084717 seconds.
sample_standardized_SOM_(6, 5)_sigma-0.01_rate-0.1 done. Time to fit the model: 15.08832836151123 seconds.
sample_standardized_SOM_(6, 5)_sigma-0.01_rate-0.2 done. Time to fit the model: 14.320567846298218 seconds.
sample_standardized_SOM_(6, 5)_sigma-0.01_rate-0.5 done. Time to fit the model: 12.988727807998657 seconds.
sample_standardized_SOM_(6, 5)_sigma-0.01_rate-1 done. Time to fit the model: 12.774047136306763 seconds.
sample_standardized_SOM_(6, 5)_sigma-0.1_rate-0.01 done. Time to fit the model: 12.655745267868042 seconds.
sample_standardized_SOM_(6, 5)_sigma-0.1_rate-0.05 done. Time to fit the model: 13.632773637771606 seconds.
sample_standardized_SOM_(6, 5)_sigma-0.1_rate-0.1 done. Time to fit the model: 13.69734263420105 seconds.
sample_standardized_SOM_(6, 5)_sigma-0.1_rate-0.2 done. Time to fit the model: 11.825275182723999 seconds.
sample_standardized_SOM_(6, 5)_sigma-0.1_rate-0.5 done. Time to fit the model: 11.564648151397705 seconds.
sample_standardized_SOM_(6, 5)_sigma-0.1_rate-1 done. Time to fit the model: 13.11095905303955 seconds.
sample_standardized_SOM_(6, 5)_sigma-0.25_rate-0.01 done. Time to fit the model: 11.38231635093689 seconds.
sample_standardized_SOM_(6, 5)_sigma-0.25_rate-0.05 done. Time to fit the model: 10.2324857711792 seconds.
sample_standardized_SOM_(6, 5)_sigma-0.25_rate-0.1 done. Time to fit the model: 10.075611352920532 seconds.
sample_standardized_SOM_(6, 5)_sigma-0.25_rate-0.2 done. Time to fit the model: 11.45384669303894 seconds.
sample_standardized_SOM_(6, 5)_sigma-0.25_rate-0.5 done. Time to fit the model: 13.136953353881836 seconds.
sample_standardized_SOM_(6, 5)_sigma-0.25_rate-1 done. Time to fit the model: 12.988116979598999 seconds.
sample_standardized_SOM_(6, 5)_sigma-0.5_rate-0.01 done. Time to fit the model: 13.676304578781128 seconds.
sample_standardized_SOM_(6, 5)_sigma-0.5_rate-0.05 done. Time to fit the model: 13.65310263633728 seconds.
sample_standardized_SOM_(6, 5)_sigma-0.5_rate-0.1 done. Time to fit the model: 11.345702409744263 seconds.
sample_standardized_SOM_(6, 5)_sigma-0.5_rate-0.2 done. Time to fit the model: 10.200783014297485 seconds.
sample_standardized_SOM_(6, 5)_sigma-0.5_rate-0.5 done. Time to fit the model: 10.253746271133423 seconds.
sample_standardized_SOM_(6, 5)_sigma-0.5_rate-1 done. Time to fit the model: 9.905344724655151 seconds.
sample_standardized_SOM_(6, 5)_sigma-1_rate-0.01 done. Time to fit the model: 9.97464895248413 seconds.
sample_standardized_SOM_(6, 5)_sigma-1_rate-0.05 done. Time to fit the model: 9.808958053588867 seconds.
sample_standardized_SOM_(6, 5)_sigma-1_rate-0.1 done. Time to fit the model: 9.867895603179932 seconds.
sample_standardized_SOM_(6, 5)_sigma-1_rate-0.2 done. Time to fit the model: 10.446823596954346 seconds.
sample_standardized_SOM_(6, 5)_sigma-1_rate-0.5 done. Time to fit the model: 10.370377779006958 seconds.
sample_standardized_SOM_(6, 5)_sigma-1_rate-1 done. Time to fit the model: 11.236787557601929 seconds.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;all_data.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">((</span><span class="n">labels</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">evaluations</span><span class="p">,</span> <span class="n">quant_errors</span><span class="p">),</span> <span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">times</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">evaluations</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">quant_errors</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">options</span> <span class="o">=</span> <span class="n">evaluations</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1008
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_eval</span> <span class="o">=</span> <span class="n">evaluations</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">options</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">useless</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;chunks&#39;</span> <span class="ow">in</span> <span class="n">op</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">evaluations</span><span class="p">[</span><span class="n">op</span><span class="p">][</span><span class="s2">&quot;frequencies&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">276797</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">.9</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">useless</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">evaluations</span><span class="p">[</span><span class="n">op</span><span class="p">][</span><span class="s2">&quot;frequencies&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">250000</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">.9</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">useless</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">useless</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>388
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">evaluations</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="k">if</span> <span class="n">o</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">useless</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">silhouettes_chunks</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
<span class="n">silhouettes_sample</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>


<span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
    <span class="k">if</span> <span class="s1">&#39;chunks&#39;</span> <span class="ow">in</span> <span class="n">op</span><span class="p">:</span>
        <span class="n">silhouettes_chunks</span><span class="p">[</span><span class="n">op</span><span class="p">[</span><span class="mi">7</span><span class="p">:]]</span> <span class="o">=</span> <span class="n">evaluations</span><span class="p">[</span><span class="n">op</span><span class="p">][</span><span class="s1">&#39;silhouette&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">silhouettes_sample</span><span class="p">[</span><span class="n">op</span><span class="p">[</span><span class="mi">7</span><span class="p">:]]</span> <span class="o">=</span> <span class="n">evaluations</span><span class="p">[</span><span class="n">op</span><span class="p">][</span><span class="s1">&#39;silhouette&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-98-aae62151d6e4&gt;:1: DeprecationWarning: The default dtype for empty Series will be &#39;object&#39; instead of &#39;float64&#39; in a future version. Specify a dtype explicitly to silence this warning.
  silhouettes_chunks = pd.Series()
&lt;ipython-input-98-aae62151d6e4&gt;:2: DeprecationWarning: The default dtype for empty Series will be &#39;object&#39; instead of &#39;float64&#39; in a future version. Specify a dtype explicitly to silence this warning.
  silhouettes_sample = pd.Series()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">silhouettes_chunks</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()[:</span><span class="mi">60</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>standardized_SOM_(5, 5)_sigma-1_rate-1         -0.024278
standardized_SOM_(6, 5)_sigma-0.1_rate-0.01    -0.017866
standardized_SOM_(6, 5)_sigma-0.01_rate-0.01   -0.017866
standardized_SOM_(6, 5)_sigma-0.25_rate-0.01   -0.017779
standardized_SOM_(3, 4)_sigma-1_rate-0.5       -0.017356
standardized_SOM_(2, 5)_sigma-1_rate-0.5       -0.015143
standardized_SOM_(3, 4)_sigma-1_rate-0.2       -0.015097
standardized_SOM_(3, 4)_sigma-1_rate-1         -0.014982
standardized_SOM_(6, 5)_sigma-1_rate-1         -0.012165
standardized_SOM_(2, 6)_sigma-1_rate-0.5       -0.007150
standardized_SOM_(6, 5)_sigma-0.5_rate-0.01    -0.005978
standardized_SOM_(3, 5)_sigma-1_rate-1         -0.005481
standardized_SOM_(2, 6)_sigma-1_rate-1         -0.004917
standardized_SOM_(6, 5)_sigma-1_rate-0.2       -0.004576
standardized_SOM_(5, 5)_sigma-0.25_rate-0.01   -0.003037
standardized_SOM_(5, 5)_sigma-0.1_rate-0.01    -0.003037
standardized_SOM_(5, 5)_sigma-0.01_rate-0.01   -0.003037
standardized_SOM_(4, 5)_sigma-1_rate-1         -0.002892
standardized_SOM_(5, 5)_sigma-1_rate-0.5        0.000401
standardized_SOM_(5, 5)_sigma-0.5_rate-0.01     0.001457
standardized_SOM_(4, 5)_sigma-1_rate-0.5        0.001654
standardized_SOM_(3, 5)_sigma-1_rate-0.5        0.001845
standardized_SOM_(6, 5)_sigma-1_rate-0.5        0.002844
standardized_SOM_(2, 6)_sigma-1_rate-0.1        0.004279
standardized_SOM_(4, 5)_sigma-1_rate-0.05       0.005213
standardized_SOM_(4, 5)_sigma-0.25_rate-0.01    0.009532
standardized_SOM_(4, 5)_sigma-0.1_rate-0.01     0.009661
standardized_SOM_(4, 5)_sigma-0.01_rate-0.01    0.009661
standardized_SOM_(2, 5)_sigma-1_rate-1          0.009980
standardized_SOM_(5, 5)_sigma-1_rate-0.1        0.010408
standardized_SOM_(3, 3)_sigma-1_rate-0.1        0.012268
standardized_SOM_(6, 5)_sigma-1_rate-0.1        0.013664
standardized_SOM_(2, 5)_sigma-1_rate-0.2        0.013981
standardized_SOM_(6, 5)_sigma-1_rate-0.05       0.014087
standardized_SOM_(3, 3)_sigma-1_rate-0.5        0.015501
standardized_GMM_20                             0.015964
standardized_SOM_(3, 3)_sigma-1_rate-1          0.016246
standardized_SOM_(6, 5)_sigma-0.01_rate-0.05    0.016587
standardized_SOM_(6, 5)_sigma-0.1_rate-0.05     0.016587
standardized_SOM_(5, 5)_sigma-1_rate-0.05       0.017124
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">silhouettes_sample</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()[:</span><span class="mi">20</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>standardized_MiniBatchKMeans_15                 0.003868
standardized_MiniBatchKMeans_30                 0.006452
standardized_GMM_30                             0.006930
standardized_SOM_(6, 5)_sigma-0.25_rate-0.01    0.007282
standardized_SOM_(6, 5)_sigma-0.5_rate-0.01     0.007616
standardized_SOM_(6, 5)_sigma-1_rate-0.01       0.011388
standardized_SOM_(6, 5)_sigma-0.01_rate-0.01    0.012175
standardized_SOM_(6, 5)_sigma-0.1_rate-0.01     0.012175
standardized_SOM_(4, 5)_sigma-1_rate-0.01       0.012226
standardized_SOM_(5, 5)_sigma-1_rate-0.01       0.012382
normalized_GMM_30                               0.012945
standardized_SOM_(5, 5)_sigma-0.1_rate-0.01     0.013606
standardized_SOM_(5, 5)_sigma-0.01_rate-0.01    0.013606
standardized_SOM_(5, 5)_sigma-0.25_rate-0.01    0.015820
standardized_SOM_(5, 5)_sigma-0.5_rate-0.01     0.018615
standardized_SOM_(4, 5)_sigma-0.5_rate-0.01     0.020928
standardized_SOM_(5, 5)_sigma-1_rate-0.05       0.024459
normalized_GMM_20                               0.024881
standardized_SOM_(6, 5)_sigma-1_rate-0.05       0.026259
standardized_SOM_(4, 5)_sigma-0.25_rate-0.01    0.026938
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">calinski_chunks</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
<span class="n">calinski_sample</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>


<span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
    <span class="k">if</span> <span class="s1">&#39;chunks&#39;</span> <span class="ow">in</span> <span class="n">op</span><span class="p">:</span>
        <span class="n">calinski_chunks</span><span class="p">[</span><span class="n">op</span><span class="p">[</span><span class="mi">7</span><span class="p">:]]</span> <span class="o">=</span> <span class="n">evaluations</span><span class="p">[</span><span class="n">op</span><span class="p">][</span><span class="s1">&#39;calinski&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">calinski_sample</span><span class="p">[</span><span class="n">op</span><span class="p">[</span><span class="mi">7</span><span class="p">:]]</span> <span class="o">=</span> <span class="n">evaluations</span><span class="p">[</span><span class="n">op</span><span class="p">][</span><span class="s1">&#39;calinski&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-101-3d898caf6c7b&gt;:1: DeprecationWarning: The default dtype for empty Series will be &#39;object&#39; instead of &#39;float64&#39; in a future version. Specify a dtype explicitly to silence this warning.
  calinski_chunks = pd.Series()
&lt;ipython-input-101-3d898caf6c7b&gt;:2: DeprecationWarning: The default dtype for empty Series will be &#39;object&#39; instead of &#39;float64&#39; in a future version. Specify a dtype explicitly to silence this warning.
  calinski_sample = pd.Series()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">calinski_chunks</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()[:</span><span class="mi">40</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>standardized_SOM_(6, 5)_sigma-0.1_rate-0.01     6959.598231
standardized_SOM_(6, 5)_sigma-0.01_rate-0.01    6959.598231
standardized_SOM_(6, 5)_sigma-0.25_rate-0.01    6960.295718
standardized_SOM_(6, 5)_sigma-1_rate-1          6990.208635
standardized_SOM_(5, 5)_sigma-0.01_rate-1       7421.136225
standardized_SOM_(5, 5)_sigma-0.1_rate-1        7421.136225
standardized_SOM_(5, 5)_sigma-0.25_rate-1       7424.063839
standardized_SOM_(6, 5)_sigma-0.1_rate-1        7430.500504
standardized_SOM_(6, 5)_sigma-0.01_rate-1       7430.500504
standardized_SOM_(6, 5)_sigma-0.25_rate-1       7433.264305
standardized_SOM_(6, 5)_sigma-0.5_rate-0.01     7748.246318
standardized_SOM_(5, 5)_sigma-1_rate-1          7825.409446
standardized_SOM_(4, 5)_sigma-1_rate-1          8107.615230
standardized_SOM_(5, 5)_sigma-0.01_rate-0.01    8112.822740
standardized_SOM_(5, 5)_sigma-0.1_rate-0.01     8112.822740
standardized_SOM_(5, 5)_sigma-0.25_rate-0.01    8112.861026
standardized_SOM_(6, 5)_sigma-1_rate-0.1        8151.871415
standardized_SOM_(6, 5)_sigma-1_rate-0.05       8325.496573
standardized_SOM_(6, 5)_sigma-1_rate-0.5        8435.576391
standardized_SOM_(6, 5)_sigma-1_rate-0.2        8531.387056
standardized_SOM_(5, 5)_sigma-1_rate-0.5        8637.871332
standardized_SOM_(6, 5)_sigma-1_rate-0.01       8692.361927
standardized_SOM_(5, 5)_sigma-1_rate-0.05       8757.975202
standardized_SOM_(6, 5)_sigma-0.1_rate-0.05     8880.918331
standardized_SOM_(6, 5)_sigma-0.01_rate-0.05    8880.918331
standardized_SOM_(6, 5)_sigma-0.25_rate-0.05    8889.270389
standardized_SOM_(6, 5)_sigma-0.5_rate-1        8916.942159
standardized_SOM_(6, 5)_sigma-0.25_rate-0.5     9182.328743
standardized_SOM_(5, 5)_sigma-0.01_rate-0.5     9191.094510
standardized_SOM_(5, 5)_sigma-0.1_rate-0.5      9191.094510
standardized_SOM_(6, 5)_sigma-0.5_rate-0.5      9257.700244
standardized_SOM_(6, 5)_sigma-0.01_rate-0.5     9268.506869
standardized_SOM_(6, 5)_sigma-0.1_rate-0.5      9268.506869
standardized_SOM_(5, 5)_sigma-0.5_rate-0.01     9270.206260
standardized_SOM_(6, 5)_sigma-0.1_rate-0.1      9272.037507
standardized_SOM_(6, 5)_sigma-0.01_rate-0.1     9272.037507
standardized_SOM_(6, 5)_sigma-0.25_rate-0.1     9272.245939
standardized_SOM_(6, 5)_sigma-0.5_rate-0.05     9293.160804
standardized_SOM_(3, 4)_sigma-1_rate-1          9301.033645
standardized_SOM_(3, 4)_sigma-1_rate-0.5        9387.162748
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">calinski_sample</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()[:</span><span class="mi">20</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>standardized_SOM_(6, 5)_sigma-1_rate-0.01       4824.010917
standardized_SOM_(6, 5)_sigma-0.01_rate-0.01    4889.160249
standardized_SOM_(6, 5)_sigma-0.1_rate-0.01     4889.160249
standardized_SOM_(6, 5)_sigma-0.25_rate-0.01    4915.344589
standardized_SOM_(6, 5)_sigma-0.5_rate-0.01     4980.880058
standardized_SOM_(6, 5)_sigma-0.01_rate-0.5     5014.890213
standardized_SOM_(6, 5)_sigma-0.1_rate-0.5      5014.890213
standardized_SOM_(6, 5)_sigma-0.25_rate-0.5     5014.890213
standardized_MiniBatchKMeans_30                 5134.759793
standardized_SOM_(6, 5)_sigma-1_rate-0.05       5153.592227
standardized_SOM_(6, 5)_sigma-0.5_rate-1        5286.382837
standardized_SOM_(6, 5)_sigma-1_rate-0.1        5364.270909
standardized_SOM_(4, 5)_sigma-0.5_rate-0.5      5555.249455
standardized_SOM_(5, 5)_sigma-1_rate-0.01       5559.596842
standardized_SOM_(5, 5)_sigma-0.01_rate-0.01    5678.900502
standardized_SOM_(5, 5)_sigma-0.1_rate-0.01     5678.900502
standardized_SOM_(5, 5)_sigma-0.25_rate-0.01    5739.259915
standardized_SOM_(5, 5)_sigma-0.01_rate-0.5     5772.861153
standardized_SOM_(5, 5)_sigma-0.1_rate-0.5      5772.861153
standardized_SOM_(6, 5)_sigma-1_rate-0.2        5774.465544
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">davies_chunks</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
<span class="n">davies_sample</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>


<span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
    <span class="k">if</span> <span class="s1">&#39;chunks&#39;</span> <span class="ow">in</span> <span class="n">op</span><span class="p">:</span>
        <span class="n">davies_chunks</span><span class="p">[</span><span class="n">op</span><span class="p">[</span><span class="mi">7</span><span class="p">:]]</span> <span class="o">=</span> <span class="n">evaluations</span><span class="p">[</span><span class="n">op</span><span class="p">][</span><span class="s1">&#39;davies&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">davies_sample</span><span class="p">[</span><span class="n">op</span><span class="p">[</span><span class="mi">7</span><span class="p">:]]</span> <span class="o">=</span> <span class="n">evaluations</span><span class="p">[</span><span class="n">op</span><span class="p">][</span><span class="s1">&#39;davies&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-104-073e6f8c2f61&gt;:1: DeprecationWarning: The default dtype for empty Series will be &#39;object&#39; instead of &#39;float64&#39; in a future version. Specify a dtype explicitly to silence this warning.
  davies_chunks = pd.Series()
&lt;ipython-input-104-073e6f8c2f61&gt;:2: DeprecationWarning: The default dtype for empty Series will be &#39;object&#39; instead of &#39;float64&#39; in a future version. Specify a dtype explicitly to silence this warning.
  davies_sample = pd.Series()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">davies_chunks</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()[:</span><span class="mi">20</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>standardized_SOM_(3, 4)_sigma-0.5_rate-0.2      1.327454
standardized_SOM_(3, 4)_sigma-0.5_rate-0.5      1.328461
standardized_SOM_(3, 5)_sigma-0.5_rate-1        1.336137
standardized_SOM_(3, 5)_sigma-0.1_rate-0.2      1.351700
standardized_SOM_(3, 5)_sigma-0.01_rate-0.2     1.351700
standardized_SOM_(3, 5)_sigma-0.25_rate-0.2     1.354574
standardized_SOM_(2, 6)_sigma-0.5_rate-1        1.363487
standardized_SOM_(2, 5)_sigma-0.5_rate-0.5      1.381653
standardized_SOM_(3, 4)_sigma-0.5_rate-1        1.393961
standardized_SOM_(2, 5)_sigma-0.5_rate-1        1.394819
standardized_SOM_(4, 5)_sigma-0.5_rate-1        1.411874
normalized_SOM_(2, 6)_sigma-0.5_rate-0.01       1.426189
standardized_SOM_(2, 6)_sigma-0.5_rate-0.2      1.426299
standardized_SOM_(5, 5)_sigma-0.25_rate-1       1.437903
standardized_SOM_(5, 5)_sigma-0.01_rate-1       1.440224
standardized_SOM_(5, 5)_sigma-0.1_rate-1        1.440224
standardized_SOM_(3, 5)_sigma-0.5_rate-0.2      1.448240
standardized_SOM_(3, 3)_sigma-0.5_rate-0.01     1.469553
standardized_SOM_(3, 3)_sigma-0.1_rate-0.01     1.478125
standardized_SOM_(3, 3)_sigma-0.01_rate-0.01    1.478125
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">davies_sample</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()[:</span><span class="mi">20</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>normalized_SOM_(5, 5)_sigma-0.25_rate-1        0.803414
normalized_SOM_(6, 5)_sigma-0.25_rate-1        0.803414
normalized_SOM_(3, 4)_sigma-0.25_rate-1        0.962934
normalized_SOM_(2, 5)_sigma-0.25_rate-1        0.962934
normalized_SOM_(4, 5)_sigma-0.25_rate-1        0.962934
normalized_SOM_(3, 5)_sigma-0.25_rate-1        0.962934
normalized_SOM_(2, 6)_sigma-0.25_rate-1        0.962934
standardized_SOM_(6, 5)_sigma-0.5_rate-1       1.144874
standardized_SOM_(5, 5)_sigma-0.25_rate-0.5    1.193206
standardized_SOM_(6, 5)_sigma-0.01_rate-0.5    1.198918
standardized_SOM_(6, 5)_sigma-0.1_rate-0.5     1.198918
standardized_SOM_(6, 5)_sigma-0.25_rate-0.5    1.198918
standardized_SOM_(5, 5)_sigma-0.01_rate-0.5    1.212181
standardized_SOM_(5, 5)_sigma-0.1_rate-0.5     1.212181
standardized_SOM_(4, 5)_sigma-0.25_rate-0.5    1.212815
standardized_SOM_(4, 5)_sigma-0.01_rate-0.5    1.212815
standardized_SOM_(4, 5)_sigma-0.1_rate-0.5     1.212815
standardized_SOM_(4, 5)_sigma-0.5_rate-0.5     1.264575
normalized_SOM_(3, 3)_sigma-0.25_rate-1        1.308968
normalized_SOM_(3, 4)_sigma-0.5_rate-0.05      1.345703
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_eval</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_keys([&#39;silhouette&#39;, &#39;calinski&#39;, &#39;davies&#39;, &#39;frequencies&#39;, &#39;mod_chi&#39;, &#39;mod_p&#39;, &#39;mod_dof&#39;, &#39;mod_exp&#39;, &#39;mod_cramers_&#39;, &#39;mod_crosstab&#39;, &#39;mur_chi&#39;, &#39;mur_p&#39;, &#39;mur_dof&#39;, &#39;mur_exp&#39;, &#39;mur_cramers_v&#39;, &#39;mur_crosstab&#39;, &#39;joc_chi&#39;, &#39;joc_p&#39;, &#39;joc_dof&#39;, &#39;joc_exp&#39;, &#39;joc_cramers_v&#39;, &#39;joc_crosstab&#39;, &#39;signature_abundance&#39;, &#39;signature_areas&#39;])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fragmentation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>

<span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
    <span class="k">if</span> <span class="s1">&#39;chunks&#39;</span> <span class="ow">in</span> <span class="n">op</span><span class="p">:</span>
        <span class="n">fragmentation</span><span class="p">[</span><span class="n">op</span><span class="p">[</span><span class="mi">7</span><span class="p">:]]</span> <span class="o">=</span> <span class="n">evaluations</span><span class="p">[</span><span class="n">op</span><span class="p">][</span><span class="s1">&#39;signature_abundance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
   
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-113-66d2c596d8be&gt;:1: DeprecationWarning: The default dtype for empty Series will be &#39;object&#39; instead of &#39;float64&#39; in a future version. Specify a dtype explicitly to silence this warning.
  fragmentation = pd.Series()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fragmentation_area</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>

<span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
    <span class="k">if</span> <span class="s1">&#39;chunks&#39;</span> <span class="ow">in</span> <span class="n">op</span><span class="p">:</span>
        <span class="n">fragmentation_area</span><span class="p">[</span><span class="n">op</span><span class="p">[</span><span class="mi">7</span><span class="p">:]]</span> <span class="o">=</span> <span class="n">evaluations</span><span class="p">[</span><span class="n">op</span><span class="p">][</span><span class="s1">&#39;signature_areas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
   
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-136-010d462a7fa0&gt;:1: DeprecationWarning: The default dtype for empty Series will be &#39;object&#39; instead of &#39;float64&#39; in a future version. Specify a dtype explicitly to silence this warning.
  fragmentation_area = pd.Series()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fragmentation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">fragmentation</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;stand&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()[:</span><span class="mi">50</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>standardized_SOM_(3, 3)_sigma-0.1_rate-0.05      838
standardized_SOM_(3, 3)_sigma-0.01_rate-0.05     838
standardized_SOM_(3, 3)_sigma-0.25_rate-0.05     840
standardized_SOM_(2, 5)_sigma-0.5_rate-1         908
standardized_SOM_(3, 3)_sigma-0.5_rate-0.01      927
standardized_SOM_(3, 3)_sigma-0.25_rate-0.01     931
standardized_SOM_(2, 5)_sigma-0.1_rate-0.05      937
standardized_SOM_(2, 5)_sigma-0.01_rate-0.05     937
standardized_SOM_(2, 6)_sigma-0.5_rate-1         940
standardized_SOM_(2, 5)_sigma-0.25_rate-0.05     940
standardized_SOM_(3, 3)_sigma-0.1_rate-0.01      941
standardized_SOM_(3, 3)_sigma-0.01_rate-0.01     941
standardized_SOM_(3, 4)_sigma-0.5_rate-1         953
standardized_SOM_(3, 4)_sigma-0.5_rate-0.2       964
standardized_SOM_(2, 6)_sigma-0.5_rate-0.2       967
standardized_SOM_(2, 5)_sigma-0.01_rate-0.1     1023
standardized_SOM_(2, 5)_sigma-0.1_rate-0.1      1023
standardized_SOM_(2, 5)_sigma-0.25_rate-0.1     1023
standardized_SOM_(3, 5)_sigma-0.5_rate-1        1029
standardized_SOM_(3, 4)_sigma-0.25_rate-0.1     1040
standardized_SOM_(2, 6)_sigma-0.1_rate-0.1      1040
standardized_SOM_(3, 4)_sigma-0.01_rate-0.1     1040
standardized_SOM_(2, 6)_sigma-0.25_rate-0.1     1040
standardized_SOM_(2, 6)_sigma-0.01_rate-0.1     1040
standardized_SOM_(3, 4)_sigma-0.1_rate-0.1      1040
standardized_SOM_(3, 3)_sigma-0.25_rate-0.1     1101
standardized_SOM_(3, 3)_sigma-0.01_rate-0.1     1103
standardized_SOM_(3, 3)_sigma-0.1_rate-0.1      1103
standardized_SOM_(3, 5)_sigma-0.25_rate-0.2     1146
standardized_SOM_(2, 5)_sigma-0.5_rate-0.5      1147
standardized_SOM_(3, 5)_sigma-0.1_rate-0.2      1148
standardized_SOM_(3, 5)_sigma-0.01_rate-0.2     1148
standardized_SOM_(2, 5)_sigma-0.25_rate-0.01    1151
standardized_SOM_(2, 5)_sigma-0.1_rate-0.01     1151
standardized_SOM_(2, 5)_sigma-0.01_rate-0.01    1151
standardized_SOM_(3, 3)_sigma-0.5_rate-0.1      1185
standardized_SOM_(3, 3)_sigma-0.5_rate-0.05     1188
standardized_SOM_(2, 5)_sigma-0.5_rate-0.01     1203
standardized_SOM_(2, 5)_sigma-0.5_rate-0.05     1203
standardized_SOM_(3, 4)_sigma-0.5_rate-0.5      1218
standardized_SOM_(2, 5)_sigma-0.5_rate-0.1      1219
standardized_SOM_(3, 4)_sigma-0.5_rate-0.1      1248
standardized_SOM_(2, 6)_sigma-0.25_rate-0.05    1328
standardized_SOM_(3, 4)_sigma-0.01_rate-0.05    1329
standardized_SOM_(3, 4)_sigma-0.1_rate-0.05     1329
standardized_SOM_(3, 4)_sigma-0.25_rate-0.05    1329
standardized_SOM_(2, 6)_sigma-0.1_rate-0.05     1329
standardized_SOM_(2, 6)_sigma-0.01_rate-0.05    1329
standardized_SOM_(3, 5)_sigma-0.5_rate-0.2      1353
standardized_SOM_(5, 5)_sigma-0.25_rate-1       1354
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fragmentation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">fragmentation</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;KMeans&#39;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>normalized_KMeans_10               2547
normalized_KMeans_15               3197
normalized_KMeans_20               3771
normalized_KMeans_30               4779
normalized_MiniBatchKMeans_10      2364
normalized_MiniBatchKMeans_15      3414
normalized_MiniBatchKMeans_20      4120
normalized_MiniBatchKMeans_30      5145
standardized_KMeans_10             1661
standardized_KMeans_15             1994
standardized_KMeans_20             2365
standardized_KMeans_30             3174
standardized_MiniBatchKMeans_10    1654
standardized_MiniBatchKMeans_15    2163
standardized_MiniBatchKMeans_20    2735
standardized_MiniBatchKMeans_30    3389
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fragmentation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">fragmentation</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;GMM&#39;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>normalized_GMM_10      1409
normalized_GMM_15      1453
normalized_GMM_20      1229
normalized_GMM_30      1379
standardized_GMM_10    1520
standardized_GMM_15    1373
standardized_GMM_20    1531
standardized_GMM_30    1369
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fragmentation_area</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">fragmentation_area</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;stand&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:</span><span class="mi">40</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>standardized_GMM_30                             2700.965074
standardized_SOM_(2, 6)_sigma-1_rate-0.1        2391.975084
standardized_SOM_(2, 5)_sigma-1_rate-0.05       2374.398935
standardized_SOM_(3, 3)_sigma-1_rate-0.1        2368.246530
standardized_SOM_(4, 5)_sigma-0.5_rate-0.2      2356.992203
standardized_SOM_(6, 5)_sigma-0.01_rate-0.05    2344.947563
standardized_SOM_(6, 5)_sigma-0.1_rate-0.05     2344.947563
standardized_SOM_(6, 5)_sigma-0.25_rate-0.05    2307.287479
standardized_SOM_(3, 5)_sigma-1_rate-0.01       2284.809471
standardized_SOM_(4, 5)_sigma-0.1_rate-0.1      2281.160246
standardized_SOM_(4, 5)_sigma-0.25_rate-0.1     2281.160246
standardized_SOM_(4, 5)_sigma-0.01_rate-0.1     2281.160246
standardized_SOM_(2, 5)_sigma-1_rate-0.2        2270.651929
standardized_SOM_(3, 3)_sigma-1_rate-0.2        2266.443011
standardized_MiniBatchKMeans_30                 2244.820890
standardized_GMM_15                             2239.217112
standardized_SOM_(2, 6)_sigma-1_rate-0.01       2225.597443
standardized_SOM_(5, 5)_sigma-0.25_rate-0.2     2211.483474
standardized_SOM_(3, 3)_sigma-1_rate-0.5        2209.690410
standardized_SOM_(6, 5)_sigma-0.5_rate-0.2      2208.273922
standardized_SOM_(4, 5)_sigma-1_rate-0.2        2181.945189
standardized_SOM_(5, 5)_sigma-0.25_rate-0.05    2181.621606
standardized_KMeans_15                          2178.768019
standardized_SOM_(2, 5)_sigma-0.5_rate-0.01     2172.631353
standardized_SOM_(5, 5)_sigma-0.01_rate-0.05    2171.944870
standardized_SOM_(5, 5)_sigma-0.1_rate-0.05     2171.944870
standardized_SOM_(2, 5)_sigma-0.01_rate-0.01    2167.586785
standardized_SOM_(2, 5)_sigma-0.1_rate-0.01     2167.586785
standardized_SOM_(2, 5)_sigma-0.25_rate-0.01    2167.586785
standardized_SOM_(5, 5)_sigma-0.01_rate-0.2     2162.585085
standardized_SOM_(5, 5)_sigma-0.1_rate-0.2      2162.585085
standardized_SOM_(4, 5)_sigma-0.5_rate-0.01     2160.063375
standardized_GMM_20                             2150.874923
standardized_SOM_(6, 5)_sigma-0.25_rate-0.01    2146.214265
standardized_KMeans_30                          2141.359582
standardized_SOM_(6, 5)_sigma-0.5_rate-0.01     2135.201701
standardized_SOM_(6, 5)_sigma-0.01_rate-0.5     2131.123645
standardized_SOM_(6, 5)_sigma-0.1_rate-0.5      2131.123645
standardized_SOM_(6, 5)_sigma-0.01_rate-0.01    2129.098278
standardized_SOM_(6, 5)_sigma-0.1_rate-0.01     2129.098278
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">evaluations</span><span class="p">[</span><span class="s2">&quot;chunks_standardized_GMM_30&quot;</span><span class="p">][</span><span class="s1">&#39;frequencies&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17    24262
18    21483
12    20069
28    19235
13    17831
5     17506
11    16281
6     16210
3     15925
27    13116
19    12653
1      8949
15     8100
16     8015
9      7612
2      7590
14     6497
0      6306
24     5686
23     5089
29     4582
20     3989
21     3505
26     3180
4      1669
25      610
8       361
10      221
22      179
7        86
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">postcode</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>

<span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
    <span class="k">if</span> <span class="s1">&#39;chunks&#39;</span> <span class="ow">in</span> <span class="n">op</span><span class="p">:</span>
        <span class="n">postcode</span><span class="p">[</span><span class="n">op</span><span class="p">[</span><span class="mi">7</span><span class="p">:]]</span> <span class="o">=</span> <span class="n">evaluations</span><span class="p">[</span><span class="n">op</span><span class="p">][</span><span class="s1">&#39;mur_cramers_v&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-124-3e38af0033b5&gt;:1: DeprecationWarning: The default dtype for empty Series will be &#39;object&#39; instead of &#39;float64&#39; in a future version. Specify a dtype explicitly to silence this warning.
  postcode = pd.Series()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">postcode</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()[</span><span class="o">-</span><span class="mi">20</span><span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>standardized_SOM_(6, 5)_sigma-0.01_rate-0.01    0.193043
standardized_SOM_(6, 5)_sigma-0.25_rate-0.01    0.193126
standardized_SOM_(6, 5)_sigma-1_rate-0.01       0.193576
standardized_GMM_15                             0.195398
standardized_SOM_(6, 5)_sigma-0.5_rate-0.2      0.195544
standardized_SOM_(5, 5)_sigma-0.5_rate-0.5      0.195676
normalized_GMM_20                               0.196112
standardized_SOM_(6, 5)_sigma-1_rate-0.05       0.197000
standardized_SOM_(6, 5)_sigma-0.5_rate-0.05     0.197602
standardized_SOM_(6, 5)_sigma-0.25_rate-0.05    0.197952
standardized_SOM_(6, 5)_sigma-0.01_rate-0.05    0.198055
standardized_SOM_(6, 5)_sigma-0.1_rate-0.05     0.198055
standardized_GMM_20                             0.200421
normalized_KMeans_30                            0.201362
standardized_KMeans_20                          0.202131
normalized_MiniBatchKMeans_30                   0.204752
normalized_GMM_30                               0.204883
standardized_MiniBatchKMeans_30                 0.210613
standardized_KMeans_30                          0.214844
standardized_GMM_30                             0.215383
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jochem</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>

<span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
    <span class="k">if</span> <span class="s1">&#39;chunks&#39;</span> <span class="ow">in</span> <span class="n">op</span><span class="p">:</span>
        <span class="n">jochem</span><span class="p">[</span><span class="n">op</span><span class="p">[</span><span class="mi">7</span><span class="p">:]]</span> <span class="o">=</span> <span class="n">evaluations</span><span class="p">[</span><span class="n">op</span><span class="p">][</span><span class="s1">&#39;joc_cramers_v&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-126-60783ea3004f&gt;:1: DeprecationWarning: The default dtype for empty Series will be &#39;object&#39; instead of &#39;float64&#39; in a future version. Specify a dtype explicitly to silence this warning.
  jochem = pd.Series()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jochem</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()[</span><span class="o">-</span><span class="mi">20</span><span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>standardized_SOM_(6, 5)_sigma-1_rate-0.05      0.293012
standardized_SOM_(5, 5)_sigma-1_rate-0.5       0.293537
standardized_SOM_(6, 5)_sigma-1_rate-0.2       0.293610
normalized_MiniBatchKMeans_30                  0.293773
standardized_GMM_15                            0.295652
standardized_SOM_(6, 5)_sigma-1_rate-0.01      0.295684
standardized_SOM_(5, 5)_sigma-1_rate-0.01      0.296311
standardized_SOM_(6, 5)_sigma-1_rate-0.5       0.296498
standardized_SOM_(6, 5)_sigma-0.5_rate-0.05    0.299157
normalized_GMM_30                              0.299246
standardized_MiniBatchKMeans_15                0.299745
standardized_SOM_(5, 5)_sigma-0.5_rate-0.5     0.302494
standardized_SOM_(6, 5)_sigma-0.5_rate-0.2     0.304802
standardized_GMM_20                            0.308456
standardized_MiniBatchKMeans_20                0.311887
standardized_KMeans_15                         0.313963
standardized_KMeans_20                         0.315366
standardized_GMM_30                            0.320287
standardized_KMeans_30                         0.326838
standardized_MiniBatchKMeans_30                0.329180
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">modum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>

<span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
    <span class="k">if</span> <span class="s1">&#39;chunks&#39;</span> <span class="ow">in</span> <span class="n">op</span><span class="p">:</span>
        <span class="n">modum</span><span class="p">[</span><span class="n">op</span><span class="p">[</span><span class="mi">7</span><span class="p">:]]</span> <span class="o">=</span> <span class="n">evaluations</span><span class="p">[</span><span class="n">op</span><span class="p">][</span><span class="s1">&#39;mod_cramers_&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-129-13e43c17149a&gt;:1: DeprecationWarning: The default dtype for empty Series will be &#39;object&#39; instead of &#39;float64&#39; in a future version. Specify a dtype explicitly to silence this warning.
  modum = pd.Series()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">modum</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()[</span><span class="o">-</span><span class="mi">20</span><span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>standardized_SOM_(5, 5)_sigma-1_rate-0.1        0.298132
standardized_SOM_(4, 5)_sigma-1_rate-0.5        0.298227
standardized_SOM_(6, 5)_sigma-0.01_rate-0.1     0.301453
standardized_SOM_(6, 5)_sigma-0.1_rate-0.1      0.301453
standardized_SOM_(6, 5)_sigma-0.25_rate-0.1     0.301463
standardized_SOM_(6, 5)_sigma-0.5_rate-0.05     0.301649
standardized_SOM_(5, 5)_sigma-1_rate-0.5        0.302658
standardized_SOM_(6, 5)_sigma-0.25_rate-0.05    0.303264
standardized_SOM_(6, 5)_sigma-0.1_rate-0.05     0.303293
standardized_SOM_(6, 5)_sigma-0.01_rate-0.05    0.303293
standardized_KMeans_30                          0.304986
standardized_GMM_30                             0.305577
standardized_SOM_(4, 5)_sigma-1_rate-0.05       0.305997
standardized_SOM_(6, 5)_sigma-1_rate-0.05       0.307816
standardized_SOM_(6, 5)_sigma-1_rate-0.1        0.308840
standardized_SOM_(5, 5)_sigma-1_rate-0.01       0.308846
standardized_SOM_(6, 5)_sigma-1_rate-0.01       0.311538
standardized_MiniBatchKMeans_30                 0.311836
standardized_SOM_(6, 5)_sigma-1_rate-0.2        0.312026
standardized_SOM_(6, 5)_sigma-1_rate-0.5        0.316889
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">score</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">modum</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">score</span><span class="p">[</span><span class="s2">&quot;modum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">312</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">modum</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">score</span><span class="p">[</span><span class="s2">&quot;postcode_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">312</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">postcode</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">score</span><span class="p">[</span><span class="s2">&quot;jochem&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">312</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">jochem</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">score</span><span class="p">[</span><span class="s2">&quot;fragmentation_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">312</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">fragmentation</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">score</span><span class="p">[</span><span class="s2">&quot;fragmentation_area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">312</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">fragmentation_area</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">score</span><span class="p">[</span><span class="s2">&quot;davies&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">312</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">davies_chunks</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">score</span><span class="p">[</span><span class="s2">&quot;silhouette&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">312</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">silhouettes_chunks</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">score</span><span class="p">[</span><span class="s2">&quot;calinski&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">312</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">calinski_chunks</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">score</span><span class="p">[</span><span class="s2">&quot;total&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">score</span><span class="p">[</span><span class="s2">&quot;comparative&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span><span class="o">.</span><span class="n">modum</span> <span class="o">+</span> <span class="n">score</span><span class="o">.</span><span class="n">postcode_class</span> <span class="o">+</span> <span class="n">score</span><span class="o">.</span><span class="n">jochem</span>
<span class="n">score</span><span class="p">[</span><span class="s2">&quot;internal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span><span class="o">.</span><span class="n">davies</span> <span class="o">+</span> <span class="n">score</span><span class="o">.</span><span class="n">silhouette</span> <span class="o">+</span> <span class="n">score</span><span class="o">.</span><span class="n">calinski</span>
<span class="n">score</span><span class="p">[</span><span class="s2">&quot;fragmentation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span><span class="o">.</span><span class="n">fragmentation_count</span> <span class="o">+</span> <span class="n">score</span><span class="o">.</span><span class="n">fragmentation_area</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">score</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()[:</span><span class="mi">20</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>standardized_GMM_30                             459
normalized_GMM_30                               553
standardized_SOM_(5, 5)_sigma-0.01_rate-0.2     637
standardized_SOM_(6, 5)_sigma-0.5_rate-0.2      640
standardized_SOM_(5, 5)_sigma-0.1_rate-0.2      641
standardized_GMM_20                             683
standardized_SOM_(6, 5)_sigma-0.5_rate-0.5      683
standardized_SOM_(5, 5)_sigma-0.25_rate-0.05    694
standardized_SOM_(5, 5)_sigma-0.5_rate-0.5      694
standardized_SOM_(6, 5)_sigma-0.1_rate-0.05     698
standardized_SOM_(6, 5)_sigma-0.01_rate-0.05    700
standardized_GMM_15                             709
standardized_SOM_(5, 5)_sigma-0.01_rate-0.05    709
standardized_SOM_(6, 5)_sigma-0.1_rate-0.5      709
standardized_SOM_(5, 5)_sigma-0.1_rate-0.05     711
standardized_SOM_(6, 5)_sigma-0.01_rate-0.5     715
standardized_SOM_(4, 5)_sigma-0.1_rate-0.1      715
standardized_SOM_(6, 5)_sigma-0.25_rate-0.05    716
standardized_SOM_(4, 5)_sigma-0.25_rate-0.1     717
standardized_SOM_(4, 5)_sigma-0.01_rate-0.1     717
Name: total, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">score</span><span class="o">.</span><span class="n">comparative</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()[:</span><span class="mi">20</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>standardized_MiniBatchKMeans_30                  7
standardized_GMM_30                             13
standardized_KMeans_30                          14
standardized_KMeans_20                          32
standardized_SOM_(6, 5)_sigma-1_rate-0.01       37
standardized_SOM_(6, 5)_sigma-0.5_rate-0.05     39
standardized_SOM_(6, 5)_sigma-1_rate-0.05       40
standardized_SOM_(6, 5)_sigma-1_rate-0.2        42
standardized_SOM_(6, 5)_sigma-0.5_rate-0.2      45
standardized_SOM_(6, 5)_sigma-0.1_rate-0.05     45
standardized_SOM_(6, 5)_sigma-0.25_rate-0.05    48
standardized_SOM_(6, 5)_sigma-0.01_rate-0.05    48
standardized_SOM_(6, 5)_sigma-1_rate-0.5        49
standardized_SOM_(5, 5)_sigma-1_rate-0.01       57
standardized_SOM_(5, 5)_sigma-0.5_rate-0.5      57
standardized_SOM_(5, 5)_sigma-1_rate-0.5        70
standardized_MiniBatchKMeans_20                 79
standardized_SOM_(6, 5)_sigma-0.5_rate-0.01     80
standardized_SOM_(6, 5)_sigma-1_rate-0.1        83
standardized_KMeans_15                          87
Name: comparative, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">score</span><span class="o">.</span><span class="n">internal</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()[:</span><span class="mi">60</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>standardized_SOM_(4, 5)_sigma-0.25_rate-0.5     163
standardized_SOM_(4, 5)_sigma-0.01_rate-0.5     177
standardized_SOM_(4, 5)_sigma-0.1_rate-0.5      178
standardized_SOM_(4, 5)_sigma-0.5_rate-1        185
standardized_SOM_(5, 5)_sigma-0.01_rate-0.5     188
standardized_SOM_(5, 5)_sigma-0.1_rate-0.5      189
standardized_SOM_(6, 5)_sigma-0.1_rate-0.5      199
standardized_SOM_(6, 5)_sigma-0.01_rate-0.5     200
standardized_SOM_(5, 5)_sigma-0.5_rate-1        202
standardized_SOM_(5, 5)_sigma-0.25_rate-0.5     211
standardized_SOM_(6, 5)_sigma-0.01_rate-1       218
standardized_SOM_(6, 5)_sigma-0.1_rate-1        219
standardized_SOM_(6, 5)_sigma-0.25_rate-1       220
standardized_SOM_(6, 5)_sigma-0.25_rate-0.5     223
standardized_SOM_(6, 5)_sigma-0.5_rate-1        237
standardized_SOM_(6, 5)_sigma-0.5_rate-0.5      247
standardized_SOM_(4, 5)_sigma-0.5_rate-0.5      259
standardized_SOM_(3, 4)_sigma-1_rate-0.5        267
standardized_SOM_(5, 5)_sigma-0.25_rate-0.2     269
standardized_SOM_(4, 5)_sigma-1_rate-1          271
standardized_SOM_(2, 6)_sigma-0.5_rate-0.5      277
standardized_SOM_(2, 5)_sigma-1_rate-0.5        286
standardized_SOM_(5, 5)_sigma-0.01_rate-0.2     288
standardized_SOM_(5, 5)_sigma-0.5_rate-0.5      289
standardized_SOM_(5, 5)_sigma-0.1_rate-0.2      291
standardized_SOM_(3, 5)_sigma-0.5_rate-0.5      302
standardized_SOM_(6, 5)_sigma-0.5_rate-0.05     307
standardized_SOM_(6, 5)_sigma-0.1_rate-0.01     307
standardized_SOM_(3, 4)_sigma-1_rate-1          309
standardized_SOM_(6, 5)_sigma-1_rate-1          309
standardized_SOM_(6, 5)_sigma-0.01_rate-0.1     309
standardized_SOM_(6, 5)_sigma-0.25_rate-0.01    310
standardized_SOM_(4, 5)_sigma-0.5_rate-0.2      310
standardized_SOM_(6, 5)_sigma-0.01_rate-0.01    310
standardized_SOM_(5, 5)_sigma-1_rate-1          311
standardized_SOM_(6, 5)_sigma-0.1_rate-0.1      311
standardized_SOM_(2, 6)_sigma-1_rate-0.5        312
standardized_SOM_(6, 5)_sigma-1_rate-0.1        312
standardized_SOM_(6, 5)_sigma-0.25_rate-0.1     313
standardized_SOM_(5, 5)_sigma-0.01_rate-1       318
standardized_SOM_(3, 3)_sigma-1_rate-0.2        318
standardized_SOM_(5, 5)_sigma-0.1_rate-1        319
standardized_SOM_(5, 5)_sigma-0.5_rate-0.05     320
standardized_SOM_(5, 5)_sigma-0.5_rate-0.2      320
standardized_SOM_(5, 5)_sigma-0.25_rate-1       320
standardized_SOM_(6, 5)_sigma-0.5_rate-0.01     324
standardized_SOM_(6, 5)_sigma-1_rate-0.5        324
standardized_SOM_(6, 5)_sigma-0.1_rate-0.2      324
standardized_SOM_(6, 5)_sigma-0.01_rate-0.2     325
standardized_SOM_(3, 5)_sigma-1_rate-0.5        325
standardized_SOM_(5, 5)_sigma-1_rate-0.5        325
standardized_SOM_(6, 5)_sigma-1_rate-0.2        326
standardized_SOM_(6, 5)_sigma-0.25_rate-0.2     326
standardized_SOM_(6, 5)_sigma-0.5_rate-0.2      329
standardized_SOM_(3, 5)_sigma-0.1_rate-0.05     331
standardized_SOM_(5, 5)_sigma-1_rate-0.05       331
standardized_SOM_(3, 4)_sigma-0.1_rate-0.05     332
standardized_SOM_(6, 5)_sigma-0.5_rate-0.1      332
standardized_SOM_(6, 5)_sigma-1_rate-0.05       332
standardized_SOM_(3, 5)_sigma-0.01_rate-0.05    333
Name: internal, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">score</span><span class="o">.</span><span class="n">internal</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">score</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;GMM&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()[:</span><span class="mi">60</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>standardized_GMM_30    389
normalized_GMM_30      397
standardized_GMM_20    439
standardized_GMM_15    472
normalized_GMM_20      500
standardized_GMM_10    538
normalized_GMM_15      556
normalized_GMM_10      586
Name: internal, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">score</span><span class="o">.</span><span class="n">internal</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()[:</span><span class="mi">60</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>standardized_SOM_(4, 5)_sigma-0.25_rate-0.5     163
standardized_SOM_(4, 5)_sigma-0.01_rate-0.5     177
standardized_SOM_(4, 5)_sigma-0.1_rate-0.5      178
standardized_SOM_(4, 5)_sigma-0.5_rate-1        185
standardized_SOM_(5, 5)_sigma-0.01_rate-0.5     188
standardized_SOM_(5, 5)_sigma-0.1_rate-0.5      189
standardized_SOM_(6, 5)_sigma-0.1_rate-0.5      199
standardized_SOM_(6, 5)_sigma-0.01_rate-0.5     200
standardized_SOM_(5, 5)_sigma-0.5_rate-1        202
standardized_SOM_(5, 5)_sigma-0.25_rate-0.5     211
standardized_SOM_(6, 5)_sigma-0.01_rate-1       218
standardized_SOM_(6, 5)_sigma-0.1_rate-1        219
standardized_SOM_(6, 5)_sigma-0.25_rate-1       220
standardized_SOM_(6, 5)_sigma-0.25_rate-0.5     223
standardized_SOM_(6, 5)_sigma-0.5_rate-1        237
standardized_SOM_(6, 5)_sigma-0.5_rate-0.5      247
standardized_SOM_(4, 5)_sigma-0.5_rate-0.5      259
standardized_SOM_(3, 4)_sigma-1_rate-0.5        267
standardized_SOM_(5, 5)_sigma-0.25_rate-0.2     269
standardized_SOM_(4, 5)_sigma-1_rate-1          271
standardized_SOM_(2, 6)_sigma-0.5_rate-0.5      277
standardized_SOM_(2, 5)_sigma-1_rate-0.5        286
standardized_SOM_(5, 5)_sigma-0.01_rate-0.2     288
standardized_SOM_(5, 5)_sigma-0.5_rate-0.5      289
standardized_SOM_(5, 5)_sigma-0.1_rate-0.2      291
standardized_SOM_(3, 5)_sigma-0.5_rate-0.5      302
standardized_SOM_(6, 5)_sigma-0.5_rate-0.05     307
standardized_SOM_(6, 5)_sigma-0.1_rate-0.01     307
standardized_SOM_(3, 4)_sigma-1_rate-1          309
standardized_SOM_(6, 5)_sigma-1_rate-1          309
standardized_SOM_(6, 5)_sigma-0.01_rate-0.1     309
standardized_SOM_(6, 5)_sigma-0.25_rate-0.01    310
standardized_SOM_(4, 5)_sigma-0.5_rate-0.2      310
standardized_SOM_(6, 5)_sigma-0.01_rate-0.01    310
standardized_SOM_(5, 5)_sigma-1_rate-1          311
standardized_SOM_(6, 5)_sigma-0.1_rate-0.1      311
standardized_SOM_(2, 6)_sigma-1_rate-0.5        312
standardized_SOM_(6, 5)_sigma-1_rate-0.1        312
standardized_SOM_(6, 5)_sigma-0.25_rate-0.1     313
standardized_SOM_(5, 5)_sigma-0.01_rate-1       318
standardized_SOM_(3, 3)_sigma-1_rate-0.2        318
standardized_SOM_(5, 5)_sigma-0.1_rate-1        319
standardized_SOM_(5, 5)_sigma-0.5_rate-0.05     320
standardized_SOM_(5, 5)_sigma-0.5_rate-0.2      320
standardized_SOM_(5, 5)_sigma-0.25_rate-1       320
standardized_SOM_(6, 5)_sigma-0.5_rate-0.01     324
standardized_SOM_(6, 5)_sigma-1_rate-0.5        324
standardized_SOM_(6, 5)_sigma-0.1_rate-0.2      324
standardized_SOM_(6, 5)_sigma-0.01_rate-0.2     325
standardized_SOM_(3, 5)_sigma-1_rate-0.5        325
standardized_SOM_(5, 5)_sigma-1_rate-0.5        325
standardized_SOM_(6, 5)_sigma-1_rate-0.2        326
standardized_SOM_(6, 5)_sigma-0.25_rate-0.2     326
standardized_SOM_(6, 5)_sigma-0.5_rate-0.2      329
standardized_SOM_(3, 5)_sigma-0.1_rate-0.05     331
standardized_SOM_(5, 5)_sigma-1_rate-0.05       331
standardized_SOM_(3, 4)_sigma-0.1_rate-0.05     332
standardized_SOM_(6, 5)_sigma-0.5_rate-0.1      332
standardized_SOM_(6, 5)_sigma-1_rate-0.05       332
standardized_SOM_(3, 5)_sigma-0.01_rate-0.05    333
Name: internal, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">score</span><span class="o">.</span><span class="n">fragmentation</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()[:</span><span class="mi">20</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>standardized_GMM_30                              57
normalized_GMM_30                                58
standardized_GMM_15                              84
normalized_GMM_15                                86
standardized_SOM_(2, 5)_sigma-0.01_rate-0.01     89
standardized_SOM_(2, 5)_sigma-0.25_rate-0.01     91
standardized_SOM_(3, 3)_sigma-1_rate-0.2         91
standardized_SOM_(2, 5)_sigma-0.5_rate-0.01      92
standardized_SOM_(2, 5)_sigma-0.1_rate-0.01      93
normalized_SOM_(3, 4)_sigma-0.5_rate-0.01       104
normalized_SOM_(2, 6)_sigma-0.5_rate-0.01       105
standardized_SOM_(3, 3)_sigma-1_rate-0.1        111
normalized_GMM_20                               113
standardized_SOM_(2, 6)_sigma-1_rate-0.1        114
normalized_SOM_(2, 5)_sigma-0.5_rate-0.01       116
standardized_SOM_(2, 5)_sigma-1_rate-0.2        120
standardized_SOM_(4, 5)_sigma-0.5_rate-0.2      125
standardized_SOM_(2, 5)_sigma-1_rate-0.05       125
standardized_GMM_20                             134
standardized_SOM_(3, 3)_sigma-1_rate-0.5        138
Name: fragmentation, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">postcode_sample</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
<span class="n">jochem_sample</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
<span class="n">modum_sample</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>


<span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
    <span class="k">if</span> <span class="s1">&#39;sample&#39;</span> <span class="ow">in</span> <span class="n">op</span><span class="p">:</span>
        <span class="n">postcode_sample</span><span class="p">[</span><span class="n">op</span><span class="p">[</span><span class="mi">7</span><span class="p">:]]</span> <span class="o">=</span> <span class="n">evaluations</span><span class="p">[</span><span class="n">op</span><span class="p">][</span><span class="s1">&#39;mur_cramers_v&#39;</span><span class="p">]</span>
        <span class="n">jochem_sample</span><span class="p">[</span><span class="n">op</span><span class="p">[</span><span class="mi">7</span><span class="p">:]]</span> <span class="o">=</span> <span class="n">evaluations</span><span class="p">[</span><span class="n">op</span><span class="p">][</span><span class="s1">&#39;joc_cramers_v&#39;</span><span class="p">]</span>
        <span class="n">modum_sample</span><span class="p">[</span><span class="n">op</span><span class="p">[</span><span class="mi">7</span><span class="p">:]]</span> <span class="o">=</span> <span class="n">evaluations</span><span class="p">[</span><span class="n">op</span><span class="p">][</span><span class="s1">&#39;mod_cramers_&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-149-8df411749ae7&gt;:1: DeprecationWarning: The default dtype for empty Series will be &#39;object&#39; instead of &#39;float64&#39; in a future version. Specify a dtype explicitly to silence this warning.
  postcode_sample = pd.Series()
&lt;ipython-input-149-8df411749ae7&gt;:2: DeprecationWarning: The default dtype for empty Series will be &#39;object&#39; instead of &#39;float64&#39; in a future version. Specify a dtype explicitly to silence this warning.
  jochem_sample = pd.Series()
&lt;ipython-input-149-8df411749ae7&gt;:3: DeprecationWarning: The default dtype for empty Series will be &#39;object&#39; instead of &#39;float64&#39; in a future version. Specify a dtype explicitly to silence this warning.
  modum_sample = pd.Series()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">score_sample</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">modum_sample</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">score_sample</span><span class="p">[</span><span class="s2">&quot;modum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">310</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">modum_sample</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">score_sample</span><span class="p">[</span><span class="s2">&quot;postcode_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">310</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">postcode_sample</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">score_sample</span><span class="p">[</span><span class="s2">&quot;jochem&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">310</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">jochem_sample</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">score_sample</span><span class="p">[</span><span class="s2">&quot;davies&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">310</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">davies_sample</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">score_sample</span><span class="p">[</span><span class="s2">&quot;silhouette&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">310</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">silhouettes_sample</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">score_sample</span><span class="p">[</span><span class="s2">&quot;calinski&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">310</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">calinski_sample</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">score_sample</span><span class="p">[</span><span class="s2">&quot;total&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">score_sample</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">score_sample</span><span class="p">[</span><span class="s2">&quot;comparative&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">score_sample</span><span class="o">.</span><span class="n">modum</span> <span class="o">+</span> <span class="n">score_sample</span><span class="o">.</span><span class="n">postcode_class</span> <span class="o">+</span> <span class="n">score_sample</span><span class="o">.</span><span class="n">jochem</span>
<span class="n">score_sample</span><span class="p">[</span><span class="s2">&quot;internal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">score_sample</span><span class="o">.</span><span class="n">davies</span> <span class="o">+</span> <span class="n">score_sample</span><span class="o">.</span><span class="n">silhouette</span> <span class="o">+</span> <span class="n">score_sample</span><span class="o">.</span><span class="n">calinski</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">score_sample</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()[:</span><span class="mi">20</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>standardized_KMeans_30                          340
standardized_MiniBatchKMeans_30                 341
standardized_SOM_(6, 5)_sigma-1_rate-0.01       346
standardized_SOM_(6, 5)_sigma-1_rate-0.05       354
standardized_SOM_(6, 5)_sigma-1_rate-0.1        354
standardized_SOM_(6, 5)_sigma-0.01_rate-0.05    361
standardized_SOM_(6, 5)_sigma-0.1_rate-0.05     361
standardized_SOM_(6, 5)_sigma-1_rate-0.2        371
standardized_SOM_(6, 5)_sigma-0.5_rate-0.01     376
standardized_SOM_(5, 5)_sigma-1_rate-0.05       387
standardized_SOM_(6, 5)_sigma-0.25_rate-0.05    391
standardized_SOM_(6, 5)_sigma-0.5_rate-0.05     392
standardized_SOM_(6, 5)_sigma-0.01_rate-0.01    398
standardized_SOM_(6, 5)_sigma-0.1_rate-0.01     400
standardized_SOM_(6, 5)_sigma-0.5_rate-0.1      401
standardized_SOM_(5, 5)_sigma-1_rate-0.1        402
standardized_SOM_(6, 5)_sigma-0.25_rate-0.01    403
standardized_SOM_(5, 5)_sigma-1_rate-0.01       403
standardized_SOM_(5, 5)_sigma-0.25_rate-0.05    424
standardized_SOM_(5, 5)_sigma-0.5_rate-0.01     431
Name: total, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">score_sample</span><span class="o">.</span><span class="n">comparative</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">score_sample</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;stand&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()[:</span><span class="mi">20</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>standardized_SOM_(6, 5)_sigma-1_rate-0.05       36
standardized_SOM_(6, 5)_sigma-1_rate-0.01       37
standardized_MiniBatchKMeans_30                 39
standardized_SOM_(6, 5)_sigma-0.01_rate-0.05    41
standardized_SOM_(6, 5)_sigma-1_rate-0.1        42
standardized_SOM_(6, 5)_sigma-0.1_rate-0.05     42
standardized_SOM_(5, 5)_sigma-1_rate-0.05       56
standardized_SOM_(6, 5)_sigma-1_rate-0.2        63
standardized_SOM_(4, 5)_sigma-0.1_rate-0.05     63
standardized_SOM_(4, 5)_sigma-1_rate-0.05       65
standardized_SOM_(4, 5)_sigma-0.01_rate-0.05    66
standardized_SOM_(6, 5)_sigma-0.25_rate-0.05    69
standardized_SOM_(6, 5)_sigma-0.5_rate-0.01     69
standardized_SOM_(6, 5)_sigma-0.5_rate-0.05     72
standardized_SOM_(5, 5)_sigma-1_rate-0.01       79
standardized_SOM_(4, 5)_sigma-0.5_rate-0.05     87
standardized_SOM_(5, 5)_sigma-0.01_rate-0.05    88
standardized_SOM_(5, 5)_sigma-0.25_rate-0.05    89
standardized_SOM_(5, 5)_sigma-0.5_rate-0.05     90
standardized_SOM_(5, 5)_sigma-1_rate-0.1        91
Name: comparative, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">score_sample</span><span class="o">.</span><span class="n">internal</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()[:</span><span class="mi">20</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>standardized_SOM_(6, 5)_sigma-0.1_rate-0.2      208
standardized_SOM_(6, 5)_sigma-0.01_rate-0.2     209
standardized_SOM_(6, 5)_sigma-0.25_rate-0.2     210
standardized_KMeans_30                          218
standardized_SOM_(6, 5)_sigma-0.5_rate-0.5      235
standardized_SOM_(5, 5)_sigma-0.5_rate-0.2      242
standardized_SOM_(5, 5)_sigma-0.25_rate-0.2     258
standardized_SOM_(6, 5)_sigma-0.5_rate-0.2      259
standardized_SOM_(5, 5)_sigma-0.1_rate-0.2      259
standardized_SOM_(5, 5)_sigma-0.01_rate-0.2     263
standardized_SOM_(5, 5)_sigma-0.5_rate-0.5      264
standardized_SOM_(6, 5)_sigma-0.25_rate-0.01    284
standardized_SOM_(6, 5)_sigma-0.01_rate-0.01    289
standardized_SOM_(6, 5)_sigma-0.1_rate-0.01     290
standardized_SOM_(6, 5)_sigma-0.5_rate-1        295
standardized_SOM_(5, 5)_sigma-0.01_rate-0.1     297
standardized_SOM_(5, 5)_sigma-0.1_rate-0.1      298
standardized_SOM_(5, 5)_sigma-1_rate-0.5        298
standardized_SOM_(6, 5)_sigma-1_rate-1          298
standardized_SOM_(6, 5)_sigma-0.01_rate-0.1     302
Name: internal, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">score</span><span class="o">.</span><span class="n">total</span> <span class="o">+</span> <span class="n">score_sample</span><span class="o">.</span><span class="n">total</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">score</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">score_sample</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()[:</span><span class="mi">40</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>standardized_SOM_(6, 5)_sigma-0.1_rate-0.05     1059.0
standardized_MiniBatchKMeans_30                 1059.0
standardized_SOM_(6, 5)_sigma-0.01_rate-0.05    1061.0
standardized_SOM_(6, 5)_sigma-1_rate-0.01       1095.0
standardized_KMeans_30                          1103.0
standardized_SOM_(6, 5)_sigma-0.25_rate-0.05    1107.0
standardized_SOM_(5, 5)_sigma-0.25_rate-0.05    1118.0
standardized_SOM_(6, 5)_sigma-0.5_rate-0.01     1133.0
standardized_SOM_(5, 5)_sigma-0.01_rate-0.05    1144.0
standardized_SOM_(6, 5)_sigma-1_rate-0.05       1147.0
standardized_SOM_(5, 5)_sigma-0.1_rate-0.05     1148.0
standardized_SOM_(6, 5)_sigma-0.5_rate-0.05     1154.0
standardized_SOM_(6, 5)_sigma-1_rate-0.2        1162.0
standardized_SOM_(6, 5)_sigma-0.25_rate-0.01    1184.0
standardized_SOM_(6, 5)_sigma-0.01_rate-0.1     1189.0
standardized_SOM_(5, 5)_sigma-1_rate-0.01       1194.0
standardized_SOM_(6, 5)_sigma-0.1_rate-0.1      1194.0
standardized_SOM_(6, 5)_sigma-0.1_rate-0.01     1196.0
standardized_SOM_(6, 5)_sigma-0.01_rate-0.01    1202.0
standardized_SOM_(6, 5)_sigma-0.25_rate-0.1     1208.0
standardized_GMM_30                             1210.0
standardized_SOM_(6, 5)_sigma-0.5_rate-0.2      1228.0
standardized_SOM_(6, 5)_sigma-1_rate-0.1        1239.0
normalized_GMM_30                               1244.0
standardized_SOM_(5, 5)_sigma-0.5_rate-0.01     1267.0
standardized_SOM_(5, 5)_sigma-1_rate-0.1        1295.0
standardized_SOM_(6, 5)_sigma-0.5_rate-0.1      1299.0
standardized_SOM_(5, 5)_sigma-0.25_rate-0.1     1305.0
standardized_SOM_(4, 5)_sigma-0.5_rate-0.01     1311.0
standardized_SOM_(5, 5)_sigma-1_rate-0.05       1316.0
standardized_SOM_(4, 5)_sigma-1_rate-0.01       1353.0
standardized_KMeans_20                          1353.0
standardized_SOM_(5, 5)_sigma-0.01_rate-0.1     1360.0
standardized_SOM_(5, 5)_sigma-0.1_rate-0.1      1360.0
standardized_SOM_(5, 5)_sigma-0.5_rate-0.05     1366.0
standardized_SOM_(4, 5)_sigma-1_rate-0.05       1380.0
standardized_KMeans_15                          1387.0
standardized_SOM_(5, 5)_sigma-1_rate-0.2        1409.0
standardized_SOM_(4, 5)_sigma-0.01_rate-0.05    1416.0
standardized_SOM_(4, 5)_sigma-0.1_rate-0.05     1418.0
Name: total, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">score</span><span class="o">.</span><span class="n">comparative</span> <span class="o">+</span> <span class="n">score_sample</span><span class="o">.</span><span class="n">comparative</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">score</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">score_sample</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()[:</span><span class="mi">40</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>standardized_MiniBatchKMeans_30                  46.0
standardized_SOM_(6, 5)_sigma-1_rate-0.01        74.0
standardized_SOM_(6, 5)_sigma-1_rate-0.05        76.0
standardized_SOM_(6, 5)_sigma-0.1_rate-0.05      87.0
standardized_SOM_(6, 5)_sigma-0.01_rate-0.05     89.0
standardized_SOM_(6, 5)_sigma-1_rate-0.2        105.0
standardized_SOM_(6, 5)_sigma-0.5_rate-0.05     111.0
standardized_SOM_(6, 5)_sigma-0.25_rate-0.05    117.0
standardized_SOM_(6, 5)_sigma-1_rate-0.1        125.0
standardized_SOM_(5, 5)_sigma-1_rate-0.01       136.0
standardized_KMeans_30                          136.0
standardized_SOM_(6, 5)_sigma-0.5_rate-0.01     149.0
standardized_SOM_(6, 5)_sigma-0.5_rate-0.1      187.0
standardized_SOM_(5, 5)_sigma-0.01_rate-0.05    188.0
standardized_SOM_(5, 5)_sigma-0.25_rate-0.05    188.0
standardized_SOM_(5, 5)_sigma-0.1_rate-0.05     192.0
standardized_SOM_(4, 5)_sigma-1_rate-0.05       197.0
standardized_SOM_(5, 5)_sigma-1_rate-0.1        209.0
standardized_SOM_(5, 5)_sigma-0.5_rate-0.01     209.0
standardized_KMeans_20                          217.0
standardized_SOM_(5, 5)_sigma-1_rate-0.05       223.0
standardized_SOM_(4, 5)_sigma-0.5_rate-0.01     235.0
standardized_SOM_(6, 5)_sigma-0.1_rate-0.01     236.0
standardized_SOM_(6, 5)_sigma-0.01_rate-0.01    238.0
standardized_SOM_(6, 5)_sigma-0.01_rate-0.1     240.0
standardized_SOM_(6, 5)_sigma-0.1_rate-0.1      242.0
standardized_SOM_(6, 5)_sigma-0.25_rate-0.01    242.0
standardized_SOM_(6, 5)_sigma-0.25_rate-0.1     251.0
standardized_SOM_(4, 5)_sigma-1_rate-0.01       262.0
standardized_SOM_(5, 5)_sigma-0.5_rate-0.05     269.0
standardized_SOM_(5, 5)_sigma-1_rate-0.2        285.0
standardized_SOM_(4, 5)_sigma-0.25_rate-0.01    304.0
standardized_SOM_(6, 5)_sigma-1_rate-0.5        306.0
normalized_GMM_30                               307.0
standardized_MiniBatchKMeans_15                 314.0
standardized_KMeans_15                          315.0
standardized_SOM_(4, 5)_sigma-0.1_rate-0.01     324.0
standardized_SOM_(4, 5)_sigma-0.01_rate-0.01    326.0
standardized_SOM_(4, 5)_sigma-0.1_rate-0.05     331.0
standardized_SOM_(4, 5)_sigma-0.01_rate-0.05    335.0
Name: comparative, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">score</span><span class="o">.</span><span class="n">internal</span> <span class="o">+</span> <span class="n">score_sample</span><span class="o">.</span><span class="n">internal</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">score</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">score_sample</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()[:</span><span class="mi">40</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>standardized_SOM_(6, 5)_sigma-0.5_rate-0.5      482.0
standardized_SOM_(4, 5)_sigma-0.25_rate-0.5     505.0
standardized_SOM_(6, 5)_sigma-0.01_rate-0.5     512.0
standardized_SOM_(6, 5)_sigma-0.1_rate-0.5      514.0
standardized_SOM_(5, 5)_sigma-0.01_rate-0.5     514.0
standardized_SOM_(5, 5)_sigma-0.1_rate-0.5      516.0
standardized_SOM_(4, 5)_sigma-0.01_rate-0.5     520.0
standardized_SOM_(4, 5)_sigma-0.1_rate-0.5      522.0
standardized_SOM_(5, 5)_sigma-0.25_rate-0.5     526.0
standardized_SOM_(5, 5)_sigma-0.25_rate-0.2     527.0
standardized_SOM_(6, 5)_sigma-0.5_rate-1        532.0
standardized_SOM_(6, 5)_sigma-0.1_rate-0.2      532.0
standardized_SOM_(6, 5)_sigma-0.01_rate-0.2     534.0
standardized_SOM_(6, 5)_sigma-0.25_rate-0.2     536.0
standardized_SOM_(6, 5)_sigma-0.25_rate-0.5     541.0
standardized_SOM_(5, 5)_sigma-0.1_rate-0.2      550.0
standardized_SOM_(5, 5)_sigma-0.01_rate-0.2     551.0
standardized_SOM_(5, 5)_sigma-0.5_rate-0.5      553.0
standardized_SOM_(5, 5)_sigma-0.5_rate-0.2      562.0
standardized_SOM_(4, 5)_sigma-0.5_rate-0.5      571.0
standardized_SOM_(6, 5)_sigma-0.5_rate-0.2      588.0
standardized_SOM_(6, 5)_sigma-0.25_rate-0.01    594.0
standardized_SOM_(6, 5)_sigma-0.1_rate-0.01     597.0
standardized_SOM_(6, 5)_sigma-0.01_rate-0.01    599.0
standardized_SOM_(6, 5)_sigma-1_rate-1          607.0
standardized_SOM_(4, 5)_sigma-1_rate-1          608.0
standardized_SOM_(6, 5)_sigma-0.01_rate-0.1     611.0
standardized_SOM_(6, 5)_sigma-0.1_rate-0.1      614.0
standardized_SOM_(4, 5)_sigma-0.5_rate-0.2      616.0
standardized_SOM_(6, 5)_sigma-0.25_rate-0.1     619.0
standardized_SOM_(5, 5)_sigma-1_rate-0.5        623.0
standardized_SOM_(6, 5)_sigma-1_rate-0.1        624.0
standardized_SOM_(5, 5)_sigma-1_rate-1          625.0
standardized_SOM_(6, 5)_sigma-0.5_rate-0.05     627.0
standardized_SOM_(6, 5)_sigma-0.5_rate-0.01     631.0
standardized_SOM_(6, 5)_sigma-1_rate-0.2        634.0
standardized_SOM_(6, 5)_sigma-0.5_rate-0.1      635.0
standardized_SOM_(6, 5)_sigma-1_rate-0.5        636.0
standardized_SOM_(6, 5)_sigma-1_rate-0.05       650.0
standardized_SOM_(6, 5)_sigma-1_rate-0.01       651.0
Name: internal, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">evaluations</span><span class="p">[</span><span class="s2">&quot;chunks_standardized_GMM_30&quot;</span><span class="p">][</span><span class="s1">&#39;frequencies&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17    24262
18    21483
12    20069
28    19235
13    17831
5     17506
11    16281
6     16210
3     15925
27    13116
19    12653
1      8949
15     8100
16     8015
9      7612
2      7590
14     6497
0      6306
24     5686
23     5089
29     4582
20     3989
21     3505
26     3180
4      1669
25      610
8       361
10      221
22      179
7        86
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">evaluations</span><span class="p">[</span><span class="s2">&quot;chunks_standardized_KMeans_30&quot;</span><span class="p">][</span><span class="s1">&#39;frequencies&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>23    32317
0     28309
15    25717
4     23572
18    18582
7     17673
29    16669
11    15973
20    15864
1     14967
5     14199
13    10040
22     7694
25     7138
9      5783
3      4641
21     3207
19     3031
27     2957
14     2012
16     1952
12     1629
28      776
2       559
17      409
24      339
26      302
6       221
10      179
8        86
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span><span class="p">[</span><span class="s2">&quot;chunks_standardized_KMeans_30&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([13, 13, 13, ..., 21, 21, 21], dtype=int32)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/sample/sample_standardized_data.pq&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span> 
<span class="n">chunk_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/sample/chunks_standardized_data.pq&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>

<span class="o">%</span><span class="k">time</span> km = KMeans(n_clusters=30, n_init=10, random_state=42).fit(data)
<span class="o">%</span><span class="k">time</span> labels_ = km.predict(chunk_data)

<span class="c1"># geom51 = gpd.read_parquet(&quot;../../urbangrammar_samba/spatial_signatures/tessellation/tess_51.pq&quot;, columns=[&quot;tessellation&quot;, &quot;hindex&quot;])</span>
<span class="c1"># geom68 = gpd.read_parquet(&quot;../../urbangrammar_samba/spatial_signatures/tessellation/tess_68.pq&quot;, columns=[&quot;tessellation&quot;, &quot;hindex&quot;])</span>
<span class="c1"># geom = pd.concat([geom51, geom68]).reset_index(drop=True).rename_geometry(&quot;geometry&quot;)</span>

<span class="n">geom</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels_</span>        
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 17min 16s, sys: 4min 24s, total: 21min 41s
Wall time: 1min 28s
CPU times: user 5.76 s, sys: 0 ns, total: 5.76 s
Wall time: 605 ms
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(250000, 331)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chunk_data</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(276797, 331)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>    <span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">contextily</span> <span class="k">as</span> <span class="nn">ctx</span>
    <span class="kn">import</span> <span class="nn">urbangrammar_graphics</span> <span class="k">as</span> <span class="nn">ugg</span>
    <span class="kn">import</span> <span class="nn">dask_geopandas</span>
    <span class="kn">from</span> <span class="nn">utils.dask_geopandas</span> <span class="kn">import</span> <span class="n">dask_dissolve</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ddf</span> <span class="o">=</span> <span class="n">dask_geopandas</span><span class="o">.</span><span class="n">from_geopandas</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;labels&#39;</span><span class="p">),</span> <span class="n">npartitions</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>
<span class="n">spsig</span> <span class="o">=</span> <span class="n">dask_dissolve</span><span class="p">(</span><span class="n">ddf</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s1">&#39;labels&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">explode</span><span class="p">()</span>

<span class="n">cmap</span> <span class="o">=</span> <span class="n">ugg</span><span class="o">.</span><span class="n">get_colormap</span><span class="p">(</span><span class="n">spsig</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">nunique</span><span class="p">(),</span> <span class="n">randomize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">spsig</span><span class="o">.</span><span class="n">cx</span><span class="p">[</span><span class="mi">332971</span><span class="p">:</span><span class="mi">361675</span><span class="p">,</span> <span class="mi">379462</span><span class="p">:</span><span class="mi">404701</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s2">&quot;labels&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">.3</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">categorical</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="mi">27700</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">ugg</span><span class="o">.</span><span class="n">get_tiles</span><span class="p">(</span><span class="s1">&#39;roads&#39;</span><span class="p">,</span> <span class="n">token</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.3</span><span class="p">)</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="mi">27700</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">ugg</span><span class="o">.</span><span class="n">get_tiles</span><span class="p">(</span><span class="s1">&#39;labels&#39;</span><span class="p">,</span> <span class="n">token</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="mi">27700</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">ugg</span><span class="o">.</span><span class="n">get_tiles</span><span class="p">(</span><span class="s1">&#39;background&#39;</span><span class="p">,</span> <span class="n">token</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/validation/maps/KMeans_predicted_lpool.png&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>   

<span class="n">ax</span> <span class="o">=</span> <span class="n">spsig</span><span class="o">.</span><span class="n">cx</span><span class="p">[</span><span class="mi">218800</span><span class="p">:</span><span class="mi">270628</span><span class="p">,</span> <span class="mi">645123</span><span class="p">:</span><span class="mi">695069</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s2">&quot;labels&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">.3</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">categorical</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="mi">27700</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">ugg</span><span class="o">.</span><span class="n">get_tiles</span><span class="p">(</span><span class="s1">&#39;roads&#39;</span><span class="p">,</span> <span class="n">token</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.3</span><span class="p">)</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="mi">27700</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">ugg</span><span class="o">.</span><span class="n">get_tiles</span><span class="p">(</span><span class="s1">&#39;labels&#39;</span><span class="p">,</span> <span class="n">token</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="mi">27700</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">ugg</span><span class="o">.</span><span class="n">get_tiles</span><span class="p">(</span><span class="s1">&#39;background&#39;</span><span class="p">,</span> <span class="n">token</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/validation/maps/KMeans_predicted_gla.png&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">time</span> km = KMeans(n_clusters=30, n_init=100, random_state=42).fit(chunk_data)
<span class="o">%</span><span class="k">time</span> labels_ = km.labels_
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 2h 42min 15s, sys: 44min 14s, total: 3h 26min 30s
Wall time: 14min 20s
CPU times: user 104 µs, sys: 0 ns, total: 104 µs
Wall time: 9.3 µs
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geom</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels_</span>        

<span class="n">ddf</span> <span class="o">=</span> <span class="n">dask_geopandas</span><span class="o">.</span><span class="n">from_geopandas</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;labels&#39;</span><span class="p">),</span> <span class="n">npartitions</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>
<span class="n">spsig</span> <span class="o">=</span> <span class="n">dask_dissolve</span><span class="p">(</span><span class="n">ddf</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s1">&#39;labels&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">explode</span><span class="p">()</span>

<span class="n">cmap</span> <span class="o">=</span> <span class="n">ugg</span><span class="o">.</span><span class="n">get_colormap</span><span class="p">(</span><span class="n">spsig</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">nunique</span><span class="p">(),</span> <span class="n">randomize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">token</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">spsig</span><span class="o">.</span><span class="n">cx</span><span class="p">[</span><span class="mi">332971</span><span class="p">:</span><span class="mi">361675</span><span class="p">,</span> <span class="mi">379462</span><span class="p">:</span><span class="mi">404701</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s2">&quot;labels&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">.3</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">categorical</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="mi">27700</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">ugg</span><span class="o">.</span><span class="n">get_tiles</span><span class="p">(</span><span class="s1">&#39;roads&#39;</span><span class="p">,</span> <span class="n">token</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.3</span><span class="p">)</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="mi">27700</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">ugg</span><span class="o">.</span><span class="n">get_tiles</span><span class="p">(</span><span class="s1">&#39;labels&#39;</span><span class="p">,</span> <span class="n">token</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="mi">27700</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">ugg</span><span class="o">.</span><span class="n">get_tiles</span><span class="p">(</span><span class="s1">&#39;background&#39;</span><span class="p">,</span> <span class="n">token</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/validation/maps/KMeans30_100_lpool.png&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>   

<span class="n">ax</span> <span class="o">=</span> <span class="n">spsig</span><span class="o">.</span><span class="n">cx</span><span class="p">[</span><span class="mi">218800</span><span class="p">:</span><span class="mi">270628</span><span class="p">,</span> <span class="mi">645123</span><span class="p">:</span><span class="mi">695069</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s2">&quot;labels&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">.3</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">categorical</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="mi">27700</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">ugg</span><span class="o">.</span><span class="n">get_tiles</span><span class="p">(</span><span class="s1">&#39;roads&#39;</span><span class="p">,</span> <span class="n">token</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.3</span><span class="p">)</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="mi">27700</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">ugg</span><span class="o">.</span><span class="n">get_tiles</span><span class="p">(</span><span class="s1">&#39;labels&#39;</span><span class="p">,</span> <span class="n">token</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="mi">27700</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">ugg</span><span class="o">.</span><span class="n">get_tiles</span><span class="p">(</span><span class="s1">&#39;background&#39;</span><span class="p">,</span> <span class="n">token</span><span class="p">),</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/validation/maps/KMeans30_100_gla.png&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> 
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="full-scale">
<h2>Full scale<a class="headerlink" href="#full-scale" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">standardized_form</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/form/standardized/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;hindex&#39;</span><span class="p">)</span>
<span class="n">stand_fn</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;../../urbangrammar_samba/spatial_signatures/clustering_data/function/standardized/&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">multi</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">standardized_form</span><span class="p">,</span> <span class="n">stand_fn</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">time</span> data = data.compute()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 2min 37s, sys: 1min 25s, total: 4min 2s
Wall time: 2min 44s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span><span class="p">,</span> <span class="n">MiniBatchKMeans</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sdbAre_q1</th>
      <th>sdbAre_q2</th>
      <th>sdbAre_q3</th>
      <th>sdbPer_q1</th>
      <th>sdbPer_q2</th>
      <th>sdbPer_q3</th>
      <th>sdbCoA_q1</th>
      <th>sdbCoA_q2</th>
      <th>sdbCoA_q3</th>
      <th>ssbCCo_q1</th>
      <th>...</th>
      <th>Code_18_521_q2</th>
      <th>Code_18_334_q3</th>
      <th>Code_18_244_q1</th>
      <th>Code_18_244_q2</th>
      <th>Code_18_331_q3</th>
      <th>Code_18_132_q2</th>
      <th>Code_18_132_q3</th>
      <th>Code_18_521_q1</th>
      <th>Code_18_222_q2</th>
      <th>Code_18_521_q3</th>
    </tr>
    <tr>
      <th>hindex</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>c000e094707t0000</th>
      <td>-0.947406</td>
      <td>-0.371977</td>
      <td>0.020285</td>
      <td>-0.901199</td>
      <td>-0.237045</td>
      <td>-0.023143</td>
      <td>-0.000419</td>
      <td>-0.001515</td>
      <td>-0.010221</td>
      <td>-0.046170</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.008758</td>
      <td>0.0</td>
      <td>-0.000679</td>
      <td>0.0</td>
      <td>-0.009142</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>c000e094763t0000</th>
      <td>-0.913567</td>
      <td>-0.420861</td>
      <td>-0.271703</td>
      <td>-0.903627</td>
      <td>-0.428003</td>
      <td>-0.336729</td>
      <td>-0.000419</td>
      <td>-0.001515</td>
      <td>-0.010221</td>
      <td>-0.035325</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.008758</td>
      <td>0.0</td>
      <td>-0.000679</td>
      <td>0.0</td>
      <td>-0.009142</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>c000e094763t0001</th>
      <td>-0.878137</td>
      <td>-0.411587</td>
      <td>-0.284021</td>
      <td>-0.900393</td>
      <td>-0.416250</td>
      <td>-0.350010</td>
      <td>-0.000419</td>
      <td>-0.001515</td>
      <td>-0.010221</td>
      <td>-0.034917</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.008758</td>
      <td>0.0</td>
      <td>-0.000679</td>
      <td>0.0</td>
      <td>-0.009142</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>c000e094763t0002</th>
      <td>-0.952475</td>
      <td>-0.421566</td>
      <td>-0.283919</td>
      <td>-0.968400</td>
      <td>-0.429947</td>
      <td>-0.343165</td>
      <td>-0.000419</td>
      <td>-0.001515</td>
      <td>-0.010221</td>
      <td>-0.065649</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.008758</td>
      <td>0.0</td>
      <td>-0.000679</td>
      <td>0.0</td>
      <td>-0.009142</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>c000e094764t0000</th>
      <td>-0.964878</td>
      <td>-0.420861</td>
      <td>-0.271703</td>
      <td>-0.972440</td>
      <td>-0.420006</td>
      <td>-0.315861</td>
      <td>-0.000419</td>
      <td>-0.001515</td>
      <td>-0.010221</td>
      <td>-0.066832</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.008758</td>
      <td>0.0</td>
      <td>-0.000679</td>
      <td>0.0</td>
      <td>-0.009142</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>c102e644989t0111</th>
      <td>-0.311466</td>
      <td>-0.431706</td>
      <td>-0.373463</td>
      <td>-0.082269</td>
      <td>-0.459270</td>
      <td>-0.389532</td>
      <td>-0.000419</td>
      <td>-0.001515</td>
      <td>-0.010221</td>
      <td>0.132837</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.008758</td>
      <td>0.0</td>
      <td>-0.000679</td>
      <td>0.0</td>
      <td>-0.009142</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>c102e644989t0112</th>
      <td>-0.326671</td>
      <td>-0.461825</td>
      <td>-0.371855</td>
      <td>-0.149873</td>
      <td>-0.528701</td>
      <td>-0.386678</td>
      <td>-0.000419</td>
      <td>-0.001515</td>
      <td>-0.010221</td>
      <td>0.136559</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.008758</td>
      <td>0.0</td>
      <td>-0.000679</td>
      <td>0.0</td>
      <td>-0.009142</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>c102e644989t0113</th>
      <td>-0.094236</td>
      <td>-0.364761</td>
      <td>-0.304254</td>
      <td>0.024972</td>
      <td>-0.347371</td>
      <td>-0.283669</td>
      <td>-0.000419</td>
      <td>-0.001515</td>
      <td>-0.010221</td>
      <td>0.021411</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.008758</td>
      <td>0.0</td>
      <td>-0.000679</td>
      <td>0.0</td>
      <td>-0.009142</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>c102e644989t0114</th>
      <td>-0.477667</td>
      <td>-0.568464</td>
      <td>-0.390033</td>
      <td>-0.600170</td>
      <td>-0.646516</td>
      <td>-0.472676</td>
      <td>-0.000419</td>
      <td>-0.001515</td>
      <td>-0.010221</td>
      <td>0.424887</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.008758</td>
      <td>0.0</td>
      <td>-0.000679</td>
      <td>0.0</td>
      <td>-0.009142</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>c102e644989t0115</th>
      <td>-0.413094</td>
      <td>-0.545952</td>
      <td>-0.382834</td>
      <td>-0.400108</td>
      <td>-0.610332</td>
      <td>-0.440413</td>
      <td>-0.000419</td>
      <td>-0.001515</td>
      <td>-0.010221</td>
      <td>0.160613</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.008758</td>
      <td>0.0</td>
      <td>-0.000679</td>
      <td>0.0</td>
      <td>-0.009142</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>14539578 rows × 331 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">time</span> km = KMeans(n_clusters=20, n_init=1, random_state=42).fit(data)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 27min 19s, sys: 1min 9s, total: 28min 29s
Wall time: 5min 11s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">time</span> kmb = MiniBatchKMeans(n_clusters=20, n_init=1, random_state=42, batch_size=1_000_000).fit(data)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 5min 13s, sys: 3min 53s, total: 9min 7s
Wall time: 1min 40s
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./clusters"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="mastermap_openmap_cluster.html" title="previous page">Trial of clustering on OpenMap and MasterMap data</a>
    <a class='right-next' id="next-link" href="spatial_signatures_gb.html" title="next page">Generate Spatial Signatures across GB</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Dani Arribas-Bel, Martin Fleischmann<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>